{"version":3,"sources":["assets/img/partners/polymtl.png","assets/img/partners/aep.png","assets/img/partners/protocase.png","assets/img/partners/ntx.png","assets/img/partners/diptrace.png","assets/img/logo.png","assets/img/pale_background_logo.png","components/header.js","components/footer/partners.js","components/footer/index.js","components/navbar/index.js","components/d3component.js","components/emoji.js","components/wip_warning.js","d3/hypnogram/constants.js","d3/hypnogram/mouse_over.js","d3/hypnogram/line_charts.js","d3/constants.js","d3/utils.js","d3/hypnogram/hypnogram.js","hooks/useGlobalState.js","components/d3component_scrollytelling.js","components/waypoint_direction.js","d3/evolving_chart/preproc.js","d3/evolving_chart/constants.js","d3/evolving_chart/legend.js","d3/evolving_chart/chart_states.js","d3/evolving_chart/mouse_over.js","d3/evolving_chart/evolving_chart.js","views/sleep_analysis_results/stacked_bar_chart_scrollytelling.js","d3/spectrogram/constants.js","d3/spectrogram/axes_legend.js","d3/spectrogram/spectrogram.js","views/sleep_analysis_results/spectrogram_scrollytelling.js","views/sleep_analysis_results/index.js","views/performance/index.js","requests/ping_server.js","requests/constants.js","requests/latest_release.js","views/analyze_sleep/waiting_for_server/index.js","views/analyze_sleep/upload_form/constants.js","requests/analyze_sleep.js","views/analyze_sleep/upload_form/index.js","views/analyze_sleep/analysis_in_progress.js/index.js","views/analyze_sleep/index.js","views/analyze_sleep/constants.js","components/scroll_to_top.js","index.js"],"names":["module","exports","Header","sizeClass","shapeQty","title","subtitle","description","className","_","times","i","key","Container","Col","lg","preserveAspectRatio","viewBox","x","y","points","defaultProps","Partner","img","alt","width","src","style","Partners","text","Row","Polymtl","AEP","NTX","Protocase","Diptrace","PlatformButton","href","color","iconClass","tooltipText","tooltipID","Button","id","target","UncontrolledTooltip","delay","Copyright","Date","getFullYear","rel","Navfooter","Nav","NavItem","NavLink","Footer","React","Component","render","md","OutsideLink","linkName","ResponsiveCollapse","children","isCollapseOpen","setIsCollapseOpen","useState","collapseClass","setCollapseClass","Fragment","onClick","Collapse","navbar","isOpen","onExiting","onExited","xs","to","PaleBackgroundLogo","Navbar","navbarstrapRef","useRef","useEffect","headroom","Headroom","current","init","destroy","ref","expand","NavbarBrand","tag","Link","Logo","D3Component","memo","callback","data","useDiv","Spinner","height","Emoji","symbol","label","role","aria-label","aria-hidden","WIPWarning","Alert","CANVAS_DIMENSION","MARGIN","DIMENSION","WIDTH","HEIGHT","COMPARATIVE_COLORS","Classifier","Electrophysiologist","createMouseOver","g","bisectTime","d3","d","left","append","attr","lineHover","dateHover","circleHover","selectAll","enter","name","textHover","on","mouse","this","timestamp","timestamps","values","map","currentTimeDate","invert","idx","epochIdx","currentValue","getHoveredData","sleepStage","createLine","curve","createAxes","xAxis","yAxis","call","createTitle","createLegend","hypnogramNames","comparativeColors","legendData","zip","createHypnogramChart","chartTitle","line","g_chart","STAGE_TO_COLOR","W","N1","N2","N3","REM","STAGES_ORDERED","convertAPIFormatToCSVFormat","epochs","stages","el","Object","convertTimestampsToDates","row","parseTimestampToDate","convertEpochsToAnnotations","annotations","nbEpochs","length","currentAnnotationStart","currentSleepStage","currentAnnotationEpochCount","forEach","index","isSleepStageTransition","push","stage","proportion","start","end","duration","saveCurrentAnnotation","date","getUTCFullYear","getUTCMonth","getUTCDay","getUTCHours","getUTCMinutes","getUTCSeconds","createHypnogram","containerNode","svg","range","colors","initializeScales","tickFormat","initializeAxes","createDrawingGroup","dates","datum","domain","setDomainOnScales","hypno","preprocessData","createSingleHypnogram","createComparativeHypnogram","useGlobalState","createGlobalState","response","isFormSubmitted","postFormError","D3ComponentScrollyTelling","isInitialized","setIsInitialized","WaypointDirection","onUp","onDown","onEnter","previousPosition","Waypoint","below","bottomOffset","fireOnRapidScroll","getStageTimeProportions","nbEpochPerSleepStage","countBy","mapValues","countPerStage","findFirstStageIndex","reduce","firstStageIndexes","findIndex","element","BAR_HEIGHT","MAP_STAGE_TO_LABEL_OFFSET","MAP_STAGE_TO_COLOR_OFFSET","setAttrOnAnnotationRects","annotationRects","yPosition","tooltip","setTooltip","transition","show","hide","getVerticalPositionCallback","indexOf","getFirstRectangleProportionWidthCallback","stageTimeProportions","createVerticalAxis","transitionHorizontalAxis","select","createProportionLabels","round","getCumulativeProportionOfNightAtStart","totalStageProportions","sum","slice","stage_ordered","getOffsetSleepStageProportionCallback","cumulSumProportions","cumulSum","filter","annotation","annotationIndexSleepStage","annotationsProportionByStage","annotationsProportion","currentCumulSum","initializeTooltip","getToolTipText","tip","offset","html","getBarToolTipText","DateTime","fromJSDate","toFormat","diff","getStackedToolTipText","Duration","fromMillis","EPOCH_DURATION_SEC","instanceChartCallbacks","timelineChartCallbacks","barChartCallbacks","stackedBarChartCallbacks","createEvolvingChart","xTime","xLinear","xTimeAxis","getHours","xLinearAxis","tickSize","first","last","nightDuration","hours","barToolTip","stackedToolTip","initializeTooltips","bindAnnotationsToRects","fromInitial","interrupt","fromInstance","remove","createTimelineChartCallbacks","fromTimeline","fromBarChart","xProportionCallback","createInstanceChartCallbacks","xAxisLinear","fromStackedBarChart","TRANSITION_TIME_MS","createBarChartCallbacks","firstAnnotationsByStage","getHorizontalPositionSleepStage","toUTC","createStackedBarChartCallbacks","StackedBarChartScrollyTelling","position","top","marginBottom","Card","CardBody","TITLE_POSITION_Y","drawSpectrogramAxesAndLegend","scalesAndAxesBySpectrogram","canvasWidth","spectrogramWidth","singleSpectrogramCanvasHeight","singleSpectrogramHeight","yColor","channel","spectrogramDrawingGroup","legendDrawingGroup","createDrawingGroups","channelName","drawTitle","drawAxes","spectrogramHeight","interpolate","NB_POINTS_COLOR_INTERPOLATION","ticks","drawLegend","spectrogramCallbacks","getScalesAndAxes","dimensions","yLinear","yBand","interpolator","rectangles","frequencies","intensity","drawSpectrogramRectangles","canvas","highlightedSleepStage","context","node","getContext","each","rectangleWidth","resetTransform","translate","frequency","beginPath","fillRect","bandwidth","globalAlpha","isHighlighted","fillStyle","fill","stroke","createSpectrogram","parentDiv","getBoundingClientRect","canvasHeight","Math","min","window","innerHeight","spectrogramsHeight","NB_SPECTROGRAM","getDimensions","channelNames","keys","keyName","includes","preprocessedData","powerAmplitudesByTimestamp","hypnogram","flatMap","powerAmplitudeSingleTimestamp","zipObject","createSpectrogramWithHighlightedStageCallback","ctx","clearRect","SpectrogramScrollyTelling","spectrograms","SleepAnalysisResults","pathname","encodedJsonEpochs","encodeURIComponent","JSON","stringify","download","ClassificationReport","rows","Table","size","responsive","j","Performance","predictedWoman78yoSleepEDF","physionetWoman78yoSleepEDF","predictedWilliamCyton","electrophysiologistWilliamCyton","electrophysiologistWoman78yoSleepEDF","pingServer","Axios","get","pipe","catchError","of","octokit","Octokit","CURRENT_OS_NAME","detect","os","ASSET_DISPLAYNAME_MAP","getPublishedReleases","a","repos","listReleases","owner","repo","releases","publishedReleases","release","draft","getLatestServerReleaseAssets","latestRelease","assets","asset","startsWith","currentOs","url","browser_download_url","WaitingForServer","setAssets","then","ListGroup","ListGroupItem","active","DEVICES","analyzeSleep","formData","post","obj","FormData","objectToFormData","headers","filterOutDateTimeFields","entries","value","endsWith","mergeDateTimeFields","field","replace","filterInDateTimeFields","fieldPrefix","floor","fieldName","join","getTime","postForm","setResponse","setPostFormError","setIsFormSubmitted","toPromise","console","error","UploadForm","useForm","mode","register","handleSubmit","getValues","errors","padding","sm","Form","noValidate","onSubmit","fromEntries","file","CustomInput","innerRef","required","validate","files","type","toLowerCase","bsSize","accept","message","FormGroup","Label","for","defaultValue","device","form","inline","sex","check","Input","max","placeholder","age","InputGroup","local","toISODate","stream_start_date","stream_start_time","bedtime_date","bedtime_time","now","wakeup_date","wakeup_time","block","AnalysisInProgress","AnalyzeSleep","serverReady","setServerReady","period","subscription","timer","exhaustMap","subscribe","ready","unsubscribe","hidden","ScrollToTop","location","scrollTo","propTypes","PropTypes","object","isRequired","array","withRouter","underConstruction","ReactDOM","exact","path","document","getElementById"],"mappings":"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","file":"static/js/main.004a89b7.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/polymtl.3034d991.png\";","module.exports = __webpack_public_path__ + \"static/media/aep.fda414f1.png\";","module.exports = __webpack_public_path__ + \"static/media/protocase.53bfde7a.png\";","module.exports = __webpack_public_path__ + \"static/media/ntx.bdd09ab5.png\";","module.exports = __webpack_public_path__ + \"static/media/diptrace.e3ba6abc.png\";","module.exports = __webpack_public_path__ + \"static/media/logo.bcea7572.png\";","module.exports = __webpack_public_path__ + \"static/media/pale_background_logo.fa35130a.png\";","import React from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport { Col, Container } from 'reactstrap';\n\nconst Header = ({ sizeClass, shapeQty, title, subtitle, description }) => {\n  return (\n    <section className={`section section-lg section-shaped ${sizeClass}`}>\n      <div className=\"shape shape-style-1 shape-dark\">\n        {_.times(shapeQty, (i) => (\n          <span key={i} />\n        ))}\n      </div>\n      <Container>\n        <div className=\"col px-0\">\n          <Col lg=\"6\">\n            <h1 className=\"display-3 text-white\">\n              {title}\n              <span>{subtitle}</span>\n            </h1>\n            <p className=\"lead text-white\">{description}</p>\n          </Col>\n        </div>\n      </Container>\n\n      <div className=\"separator separator-bottom separator-skew\">\n        <svg preserveAspectRatio=\"none\" viewBox=\"0 0 2560 100\" x=\"0\" y=\"0\">\n          <polygon className=\"fill-white\" points=\"2560 0 2560 110 0 100\" />\n        </svg>\n      </div>\n    </section>\n  );\n};\n\nHeader.propTypes = {\n  sizeClass: PropTypes.string,\n  shapeQty: PropTypes.number,\n  title: PropTypes.string,\n  subtitle: PropTypes.string,\n  description: PropTypes.string,\n};\n\nHeader.defaultProps = {\n  sizeClass: 'pb-150',\n  shapeQty: 5,\n  title: '',\n  subtitle: '',\n  description: '',\n};\n\nexport default Header;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Container, Row } from 'reactstrap';\n\nimport text from './text.json';\n\nimport Polymtl from 'assets/img/partners/polymtl.png';\nimport AEP from 'assets/img/partners/aep.png';\nimport Protocase from 'assets/img/partners/protocase.png';\nimport NTX from 'assets/img/partners/ntx.png';\nimport Diptrace from 'assets/img/partners/diptrace.png';\n\nconst Partner = ({ img, alt, width }) => {\n  return <img alt={alt} className=\"img-center img-fluid\" src={img} style={{ width: `${width}px` }} />;\n};\n\nPartner.propTypes = {\n  img: PropTypes.string.isRequired,\n  alt: PropTypes.string,\n  width: PropTypes.number,\n};\n\nPartner.defaultProps = {\n  alt: '...',\n  width: 100,\n};\n\nconst Partners = () => {\n  return (\n    <Container>\n      <h3 className=\"mt-md mb-5\">{text['sponsor_thank-you']}</h3>\n      <Row className=\"align-items-center mb-5\">\n        <Partner alt=\"Polytechnique Montréal\" img={Polymtl} width={125} />\n        <Partner alt=\"Association Étudiante de Polytechnique\" img={AEP} width={125} />\n        <Partner alt=\"NeurotechX\" img={NTX} width={125} />\n        <Partner alt=\"Protocase\" img={Protocase} width={125} />\n        <Partner alt=\"Diptrace\" img={Diptrace} width={125} />\n      </Row>\n    </Container>\n  );\n};\n\nexport default Partners;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Button, NavItem, NavLink, Nav, Container, Row, Col, UncontrolledTooltip } from 'reactstrap';\n\nimport Partners from './partners';\nimport text from './text.json';\n\nconst PlatformButton = ({ href, color, iconClass, tooltipText, tooltipID }) => {\n  return (\n    <>\n      <Button className=\"btn-icon-only rounded-circle ml-1\" color={color} href={href} id={tooltipID} target=\"_blank\">\n        <span className=\"btn-inner--icon\">\n          <i className={`fa ${iconClass}`} />\n        </span>\n      </Button>\n      <UncontrolledTooltip delay={0} target={tooltipID}>\n        {tooltipText}\n      </UncontrolledTooltip>\n    </>\n  );\n};\n\nPlatformButton.propTypes = {\n  href: PropTypes.string.isRequired,\n  color: PropTypes.string,\n  iconClass: PropTypes.string,\n  tooltipText: PropTypes.string,\n  tooltipID: PropTypes.string.isRequired,\n};\n\nPlatformButton.defaultProps = {\n  color: 'secondary',\n  iconClass: '',\n  tooltipText: '',\n};\n\nconst Copyright = () => {\n  return (\n    <div className=\"copyright\">\n      © {new Date().getFullYear()}{' '}\n      <a href=\"http://polycortex.polymtl.ca/\" target=\"_blank\" rel=\"noopener noreferrer\">\n        {text['footer_copyright_polycortex']}\n      </a>\n    </div>\n  );\n};\n\nconst Navfooter = () => {\n  return (\n    <Nav className=\" nav-footer justify-content-end\">\n      <NavItem>\n        <NavLink href=\"http://polycortex.polymtl.ca/\" target=\"_blank\">\n          {text['footer_about-us']}\n        </NavLink>\n      </NavItem>\n      <NavItem>\n        <NavLink href=\"https://github.com/PolyCortex\" target=\"_blank\">\n          {text['footer_license']}\n        </NavLink>\n      </NavItem>\n    </Nav>\n  );\n};\n\nclass Footer extends React.Component {\n  render() {\n    return (\n      <footer className=\"footer\">\n        <Partners />\n        <Container>\n          <hr />\n          <h3 className=\"text-primary font-weight-light mb-2\">{text['support_title']}</h3>\n          <Row className=\"row-grid align-items-center mb-5\">\n            <Col className=\"mt-sm\" lg=\"8\">\n              <h4 className=\" mb-3 font-weight-light\">{text['support_platforms']}</h4>\n              <PlatformButton\n                href=\"https://www.facebook.com/polycortex\"\n                color=\"facebook\"\n                iconClass=\"fa-facebook\"\n                tooltipText={text['support_facebook_tooltip']}\n                tooltipID=\"tooltip_facebook\"\n              />\n              <PlatformButton\n                href=\"https://www.instagram.com/polycortex/\"\n                color=\"instagram\"\n                iconClass=\"fa-instagram\"\n                tooltipText={text['support_instagram_tooltip']}\n                tooltipID=\"tooltip_instagram\"\n              />\n              <PlatformButton\n                href=\"https://github.com/PolyCortex\"\n                color=\"github\"\n                iconClass=\"fa-github\"\n                tooltipText={text['support_github_tooltip']}\n                tooltipID=\"tooltip_github\"\n              />\n            </Col>\n\n            <Col className=\"text-lg-right\" lg=\"4\">\n              <h4 className=\"mb-3 font-weight-light\">{text['support_donate_text']}</h4>\n              <Button color=\"success\" href=\"https://soutien.polymtl.ca/vie-etudiante\" target=\"_blank\">\n                {text['support_donate_button']}\n              </Button>\n            </Col>\n          </Row>\n          <hr />\n          <Row className=\" align-items-center justify-content-md-between\">\n            <Col md=\"6\">\n              <Copyright />\n            </Col>\n            <Col md=\"6\">\n              <Navfooter />\n            </Col>\n          </Row>\n        </Container>\n      </footer>\n    );\n  }\n}\n\nexport default Footer;\n","import React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link } from 'react-router-dom';\nimport Headroom from 'headroom.js';\nimport {\n  Navbar as NavbarStrap,\n  Container,\n  NavbarBrand,\n  NavItem,\n  Nav,\n  NavLink,\n  UncontrolledTooltip,\n  Row,\n  Col,\n  Button,\n  Collapse,\n} from 'reactstrap';\n\nimport Logo from 'assets/img/logo.png';\nimport PaleBackgroundLogo from 'assets/img/pale_background_logo.png';\nimport text from './text.json';\n\nconst OutsideLink = ({ href, iconClass, linkName, tooltipText, tooltipID }) => {\n  return (\n    <NavItem>\n      <NavLink className=\"nav-link-icon\" href={href} id={tooltipID} target=\"_blank\">\n        <i className={`fa ${iconClass}`} />\n        <span className=\"nav-link-inner--text d-lg-none ml-2\">{linkName}</span>\n      </NavLink>\n      <UncontrolledTooltip delay={0} target={tooltipID}>\n        {tooltipText}\n      </UncontrolledTooltip>\n    </NavItem>\n  );\n};\n\nOutsideLink.propTypes = {\n  href: PropTypes.string.isRequired,\n  iconClass: PropTypes.string,\n  linkName: PropTypes.string,\n  tooltipText: PropTypes.string,\n  tooltipID: PropTypes.string.isRequired,\n};\n\nOutsideLink.defaultProps = {\n  iconClass: '',\n  linkName: '',\n  tooltipText: '',\n};\n\nconst ResponsiveCollapse = ({ children, isCollapseOpen, setIsCollapseOpen }) => {\n  const [collapseClass, setCollapseClass] = useState('');\n\n  return (\n    <React.Fragment>\n      <button className=\"navbar-toggler\" onClick={() => setIsCollapseOpen(!isCollapseOpen)}>\n        <span className=\"navbar-toggler-icon\" />\n      </button>\n      <Collapse\n        navbar\n        isOpen={isCollapseOpen}\n        className={collapseClass}\n        onExiting={() => {\n          setCollapseClass('collapsing-out');\n        }}\n        onExited={() => {\n          setCollapseClass('');\n        }}\n      >\n        <div className=\"navbar-collapse-header\">\n          <Row>\n            <Col className=\"collapse-brand\" xs=\"6\">\n              <Link to=\"/\">\n                <img alt=\"Polydodo\" src={PaleBackgroundLogo} />\n              </Link>\n            </Col>\n            <Col className=\"collapse-close\" xs=\"6\">\n              <Button color=\"link\" className=\"navbar-toggler\" onClick={() => setIsCollapseOpen(false)}>\n                <span />\n                <span />\n              </Button>\n            </Col>\n          </Row>\n        </div>\n        {children}\n      </Collapse>\n    </React.Fragment>\n  );\n};\n\nResponsiveCollapse.propTypes = {\n  children: PropTypes.array.isRequired,\n};\n\nconst Navbar = () => {\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n  const navbarstrapRef = useRef();\n  useEffect(() => {\n    const headroom = new Headroom(navbarstrapRef.current);\n    headroom.init();\n    return () => headroom.destroy();\n  });\n\n  return (\n    <div ref={(ref) => (navbarstrapRef.current = ref)} className=\"navbar-main navbar-transparent navbar-light headroom\">\n      <NavbarStrap id=\"navbar-main\" expand=\"lg\">\n        <Container>\n          <NavbarBrand className=\"mr-lg-5\" to=\"/\" tag={Link}>\n            <img alt=\"Polydodo\" src={Logo} />\n          </NavbarBrand>\n\n          <ResponsiveCollapse isCollapseOpen={isCollapseOpen} setIsCollapseOpen={setIsCollapseOpen}>\n            <Nav className=\"navbar-nav-hover align-items-lg-center\" navbar>\n              <NavItem onClick={() => setIsCollapseOpen(false)}>\n                <NavLink to=\"/\" tag={Link}>\n                  {text['navbar_home']}\n                </NavLink>\n              </NavItem>\n              <NavItem onClick={() => setIsCollapseOpen(false)}>\n                <NavLink to=\"/record-my-sleep\" tag={Link}>\n                  {text['navbar_record']}\n                </NavLink>\n              </NavItem>\n              <NavItem onClick={() => setIsCollapseOpen(false)}>\n                <NavLink to=\"/analyze-my-sleep\" tag={Link}>\n                  {text['navbar_analyze']}\n                </NavLink>\n              </NavItem>\n              <NavItem onClick={() => setIsCollapseOpen(false)}>\n                <NavLink to=\"/performance\" tag={Link}>\n                  {text['navbar_performance']}\n                </NavLink>\n              </NavItem>\n            </Nav>\n\n            <Nav className=\"align-items-lg-center ml-lg-auto\" navbar>\n              <OutsideLink\n                href=\"https://www.facebook.com/PolyCortex/\"\n                iconClass=\"fa-facebook-square\"\n                linkName=\"Facebook\"\n                tooltipText={text['navbar_facebook_tooltip']}\n                tooltipID=\"tooltip333589074\"\n              />\n              <OutsideLink\n                href=\"https://www.instagram.com/polycortex/\"\n                iconClass=\"fa-instagram\"\n                linkName=\"Instagram\"\n                tooltipText={text['navbar_instagram_tooltip']}\n                tooltipID=\"tooltip356693867\"\n              />\n              <OutsideLink\n                href=\"https://github.com/PolyCortex\"\n                iconClass=\"fa-github\"\n                linkName=\"Github\"\n                tooltipText={text['navbar_github_tooltip']}\n                tooltipID=\"tooltip112445449\"\n              />\n            </Nav>\n          </ResponsiveCollapse>\n        </Container>\n      </NavbarStrap>\n    </div>\n  );\n};\n\nexport default Navbar;\n","import React, { useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { Spinner, Row, Col } from 'reactstrap';\n\nconst D3Component = React.memo(({ callback, data, useDiv = false }) => {\n  if (data === null)\n    return (\n      <Row>\n        <Col className=\"text-center\">\n          <Spinner style={{ width: '3rem', height: '3rem' }} />\n        </Col>\n      </Row>\n    );\n  const ref = useRef();\n  useEffect(() => {\n    callback(ref.current, data);\n  });\n  return useDiv ? <div ref={ref} /> : <svg ref={ref} />;\n});\n\nD3Component.propTypes = {\n  callback: PropTypes.func.isRequired,\n  data: PropTypes.any,\n  // Using a div node instead of a svg node allows usage of child components of other types:\n  // i.g., for performance issues, we used both canvas & svg child elements in a visualisation.\n  useDiv: PropTypes.bool,\n};\n\nexport default D3Component;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Emoji = ({ symbol, label }) => (\n  <span role=\"img\" aria-label={label} aria-hidden={label ? 'false' : 'true'}>\n    {symbol}\n  </span>\n);\n\nEmoji.propTypes = {\n  symbol: PropTypes.string.isRequired,\n  label: PropTypes.string,\n};\n\nEmoji.defaultProps = {\n  label: '',\n};\n\nexport default Emoji;\n","import React from 'react';\nimport { Alert } from 'reactstrap';\nimport Emoji from './emoji';\n\nconst WIPWarning = () => {\n  return (\n    <Alert color=\"warning\">\n      <span>\n        <Emoji symbol=\"🚧\" />\n        <strong> This is a work in progress. </strong>\n        The following data is mocked. <Emoji symbol=\"🚧\" />\n      </span>\n    </Alert>\n  );\n};\n\nexport default WIPWarning;\n","export const CANVAS_DIMENSION = {\n  WIDTH: 1000,\n  HEIGHT: 400,\n};\nexport const MARGIN = {\n  TOP: 100,\n  RIGHT: 10,\n  BOTTOM: 70,\n  LEFT: 70,\n};\nexport const DIMENSION = {\n  WIDTH: CANVAS_DIMENSION.WIDTH - MARGIN.LEFT - MARGIN.RIGHT,\n  HEIGHT: CANVAS_DIMENSION.HEIGHT - MARGIN.TOP - MARGIN.BOTTOM,\n};\nexport const COMPARATIVE_COLORS = {\n  Classifier: '#efce31',\n  'Sleep-EDF': '#006aff',\n  Electrophysiologist: '#ff7575',\n};\n","import * as d3 from 'd3';\nimport { DIMENSION, MARGIN } from './constants';\n\nconst getHoveredData = (data, x, mouse, bisectTime) => {\n  const timestamps = data[0].values.map((x) => x.timestamp);\n  const currentTimeDate = x.invert(mouse[0]);\n  const idx = bisectTime(timestamps, currentTimeDate, 1);\n  const epochIdx = currentTimeDate - timestamps[idx - 1] > timestamps[idx] - currentTimeDate ? idx : idx - 1;\n\n  return data.map((x) => {\n    x.currentValue = x.values[epochIdx];\n    return x;\n  });\n};\n\nconst createMouseOver = (g, x, y, data, color) => {\n  const { WIDTH, HEIGHT } = DIMENSION;\n  const bisectTime = d3.bisector((d) => d).left; // https://github.com/d3/d3-array#bisector_left\n\n  // Act as a child of `g` to make sure mouse events are received from the whole chart (not only the lines)\n  g.append('rect').attr('width', WIDTH).attr('height', HEIGHT).attr('opacity', 0);\n\n  const lineHover = g\n    .append('line')\n    .attr('class', 'lineHover')\n    .attr('y1', HEIGHT)\n    .attr('y2', 0)\n    .attr('stroke-width', 1)\n    .style('stroke', '#999')\n    .style('shape-rendering', 'crispEdges')\n    .style('opacity', 0);\n\n  const dateHover = g\n    .append('text')\n    .attr('class', 'lineHoverDate')\n    .attr('text-anchor', 'middle')\n    .attr('font-size', 15)\n    .attr('font-weight', 'bold')\n    .style('opacity', 0);\n\n  const circleHover = g\n    .selectAll('.hoverCircle')\n    .data(data)\n    .enter()\n    .append('circle')\n    .attr('class', 'hoverCircle')\n    .style('fill', 'none')\n    .attr('stroke', (x) => color(x.name))\n    .attr('r', 5)\n    .attr('stroke-width', '1px')\n    .style('opacity', 0);\n\n  const textHover = g\n    .selectAll('.textHover')\n    .data(data)\n    .enter()\n    .append('text')\n    .attr('class', 'textHover')\n    .style('fill', 'black')\n    .attr('text-anchor', 'start')\n    .attr('font-size', 12)\n    .style('opacity', 0)\n    .attr('stroke', (x) => color(x.name))\n    .attr('dy', (_, i) => 1 + i * 1.25 + 'em');\n\n  const mouseMove = function () {\n    const mouse = d3.mouse(this);\n\n    const hoveredData = getHoveredData(data, x, mouse, bisectTime);\n    const timestamp = hoveredData[0].currentValue.timestamp;\n\n    lineHover.attr('x1', mouse[0]).attr('x2', mouse[0]).style('opacity', 1);\n\n    dateHover\n      .text(d3.timeFormat('%H:%M:%S')(timestamp))\n      .attr('transform', `translate(${x(timestamp)},${HEIGHT + MARGIN.BOTTOM - 10})`)\n      .style('opacity', 1);\n\n    circleHover\n      .attr('cy', (x) => y(x.currentValue.sleepStage))\n      .attr('cx', x(timestamp))\n      .style('opacity', 1);\n\n    textHover\n      .attr('transform', `translate(${x(timestamp)},${(5 / 6) * HEIGHT})`)\n      .text((x) => `${x.name}: ${x.currentValue.sleepStage}`)\n      .style('opacity', 1);\n\n    x(timestamp) > (4 / 5) * WIDTH ? textHover.attr('text-anchor', 'end').attr('dx', -10) : textHover.attr('text-anchor', 'start').attr('dx', 10);\n  };\n\n  const mouseLeave = () => {\n    lineHover.style('opacity', 0);\n    dateHover.style('opacity', 0);\n    circleHover.style('opacity', 0);\n    textHover.style('opacity', 0);\n  };\n\n  g.on('mousemove', mouseMove).on('mouseleave', mouseLeave);\n};\n\nexport default createMouseOver;\n","import * as d3 from 'd3';\nimport _ from 'lodash';\n\nimport createMouseOver from './mouse_over';\nimport { DIMENSION, MARGIN } from './constants';\n\nimport '../style.css';\n\nimport './style.css';\n\nconst createHypnogramChart = (g, data, x, y, xAxis, yAxis, color, chartTitle, hypnogramNames, comparativeColors) => {\n  const line = createLine(x, y);\n  const g_chart = g.append('g');\n  g_chart\n    .selectAll()\n    .data(data)\n    .enter()\n    .append('path')\n    .attr('class', 'hypnogram__line')\n    .attr('fill', 'none')\n    .attr('d', (x) => line(x.values))\n    .attr('stroke', (x) => color(x.name))\n    .attr('stroke-width', 2);\n\n  createMouseOver(g_chart, x, y, data, color);\n  createAxes(g, xAxis, yAxis);\n  createTitle(g, chartTitle);\n  createLegend(g, hypnogramNames, comparativeColors);\n};\n\nconst createLine = (x, y) =>\n  d3\n    .line()\n    .x((d) => x(d.timestamp))\n    .y((d) => y(d.sleepStage))\n    .curve(d3.curveStepAfter);\n\nconst createAxes = (g, xAxis, yAxis) => {\n  const { HEIGHT, WIDTH } = DIMENSION;\n\n  g.append('g').attr('class', 'x visualization__axis').attr('transform', `translate(0,${HEIGHT})`).call(xAxis);\n\n  g.append('g').attr('class', 'y visualization__axis').call(yAxis);\n\n  g.append('text')\n    .text('Time')\n    .attr('text-anchor', 'end')\n    .attr('x', WIDTH)\n    .attr('y', HEIGHT + (2 / 3) * MARGIN.BOTTOM);\n\n  g.append('text')\n    .text('Sleep stage')\n    .attr('text-anchor', 'middle')\n    .attr('transform', 'rotate(-90)')\n    .attr('x', -HEIGHT / 2)\n    .attr('y', -(2 / 3) * MARGIN.LEFT);\n};\n\nconst createTitle = (g, title) => {\n  g.append('text')\n    .text(title)\n    .attr('class', 'chart-title')\n    .attr('text-anchor', 'middle')\n    .attr('y', -(3 / 4) * MARGIN.TOP)\n    .attr('x', (1 / 2) * DIMENSION.WIDTH);\n};\n\nconst createLegend = (g, hypnogramNames, comparativeColors) => {\n  const legendData = _.zip(hypnogramNames, comparativeColors).map((x) => {\n    return {\n      name: x[0],\n      color: x[1],\n    };\n  });\n\n  g.selectAll('.rect.legend')\n    .data(legendData)\n    .enter()\n    .append('rect')\n    .attr('class', 'legend')\n    .attr('stroke-width', 1)\n    .attr('fill', (x) => x.color)\n    .attr('width', '1em')\n    .attr('height', '1em')\n    .attr('y', -(1 / 2) * MARGIN.TOP)\n    .attr('x', (_, i) => `${i * 8}em`);\n\n  g.selectAll('.text.legend')\n    .data(legendData)\n    .enter()\n    .append('text')\n    .attr('class', 'legend')\n    .text((x) => x.name)\n    .attr('font-size', 12)\n    .attr('dominant-baseline', 'hanging')\n    .attr('y', -(1 / 2) * MARGIN.TOP)\n    .attr('dy', 0.25 + 'em')\n    .attr('x', (_, i) => `${1.5 + i * 11}em`);\n};\n\nexport default createHypnogramChart;\n","export const TRANSITION_TIME_MS = 1000;\nexport const STAGE_TO_COLOR = {\n  W: '#E3624B',\n  N1: '#B0C9D9',\n  N2: '#4da6fe',\n  N3: '#48587f',\n  REM: '#FFD443',\n};\nexport const STAGES_ORDERED = ['W', 'REM', 'N1', 'N2', 'N3'];\nexport const EPOCH_DURATION_SEC = 30;\nexport const EPOCH_DURATION_MS = EPOCH_DURATION_SEC * 1000;\n","import _ from 'lodash';\n\nimport { EPOCH_DURATION_SEC } from './constants';\n\nexport const convertAPIFormatToCSVFormat = (epochs) =>\n  _.zip(epochs.timestamps, epochs.stages).map((el) => Object({ timestamp: el[0], sleepStage: el[1] }));\n\nexport const convertTimestampsToDates = (data) =>\n  data.map((row) =>\n    Object({\n      ...row,\n      timestamp: parseTimestampToDate(row.timestamp),\n    }),\n  );\n\nexport const convertEpochsToAnnotations = (data) => {\n  // Epochs (original data format):\n  //    Epochs are equal-length spans of data extracted from raw continuous data [from MNE library glossary].\n  //    In our case, each epoch corresponds to a 30s portion of the night with its corresponding sleep stage label.\n  // Annotations (destination data format):\n  //    An annotation is defined by an onset, a duration, and a string description [from MNE library glossary].\n  //    In our case, an annotation is a contiguous period of the night where a subject stayed in the same sleep stage.\n\n  const annotations = [];\n  const nbEpochs = data.length;\n  let currentAnnotationStart = data[0].timestamp;\n  let currentSleepStage = data[0].sleepStage;\n  let currentAnnotationEpochCount = 0;\n\n  const isSleepStageTransition = (sleepStage, index) => sleepStage !== currentSleepStage || index === data.length - 1;\n\n  const saveCurrentAnnotation = (timestamp) => {\n    annotations.push({\n      stage: currentSleepStage,\n      proportion: currentAnnotationEpochCount / nbEpochs,\n      start: currentAnnotationStart,\n      end: timestamp,\n      duration: currentAnnotationEpochCount * EPOCH_DURATION_SEC,\n    });\n  };\n\n  data.forEach(({ timestamp, sleepStage }, index) => {\n    currentAnnotationEpochCount++;\n\n    if (isSleepStageTransition(sleepStage, index)) {\n      saveCurrentAnnotation(timestamp);\n      currentAnnotationStart = timestamp;\n      currentSleepStage = sleepStage;\n      currentAnnotationEpochCount = 0;\n    }\n  });\n\n  return annotations;\n};\n\nconst parseTimestampToDate = (timestamp) => {\n  // To convert UNIX timestamp to JS Date, we have to convert number of seconds to milliseconds.\n  const date = new Date(timestamp * 1000);\n  return new Date(\n    date.getUTCFullYear(),\n    date.getUTCMonth(),\n    date.getUTCDay(),\n    date.getUTCHours(),\n    date.getUTCMinutes(),\n    date.getUTCSeconds(),\n  );\n};\n","import * as d3 from 'd3';\nimport _ from 'lodash';\n\nimport createHypnogramChart from './line_charts';\nimport { DIMENSION, MARGIN, COMPARATIVE_COLORS, CANVAS_DIMENSION } from './constants';\nimport { STAGES_ORDERED } from '../constants';\nimport { convertAPIFormatToCSVFormat, convertTimestampsToDates } from '../utils';\n\nconst initializeScales = (comparativeColors) =>\n  Object({\n    x: d3.scaleTime([0, DIMENSION.WIDTH]),\n    y: d3.scaleOrdinal(_.range(0, DIMENSION.HEIGHT + 1, DIMENSION.HEIGHT / STAGES_ORDERED.length)),\n    colors: d3.scaleOrdinal(comparativeColors),\n  });\n\nconst initializeAxes = (x, y) =>\n  Object({\n    xAxis: d3.axisBottom(x).tickFormat(d3.timeFormat('%H:%M')),\n    yAxis: d3.axisLeft(y),\n  });\n\nconst createDrawingGroup = (svg) => svg.append('g').attr('transform', `translate(${MARGIN.LEFT}, ${MARGIN.TOP})`);\n\nconst preprocessData = (data, hypnogramNames) => {\n  data = data.map(convertAPIFormatToCSVFormat);\n  data = data.map((hypno) => convertTimestampsToDates(hypno));\n  return _.zip(data, hypnogramNames).map((x) =>\n    Object({\n      name: x[1],\n      values: x[0],\n    }),\n  );\n};\n\nconst setDomainOnScales = (x, y, colors, data) => {\n  const dates = data[0].values.map((datum) => datum.timestamp);\n  x.domain([d3.min(dates), d3.max(dates)]);\n  y.domain(STAGES_ORDERED);\n  colors.domain(data.map((x) => x.name));\n};\n\nconst createHypnogram = (containerNode, data, chartTitle, hypnogramNames, comparativeColors) => {\n  const svg = d3.select(containerNode).attr('viewBox', `0, 0, ${CANVAS_DIMENSION.WIDTH}, ${CANVAS_DIMENSION.HEIGHT}`);\n  const { x, y, colors } = initializeScales(comparativeColors);\n  const { xAxis, yAxis } = initializeAxes(x, y);\n  const g = createDrawingGroup(svg);\n\n  data = preprocessData(data, hypnogramNames);\n  setDomainOnScales(x, y, colors, data);\n  createHypnogramChart(g, data, x, y, xAxis, yAxis, colors, chartTitle, hypnogramNames, comparativeColors);\n};\n\nexport const createSingleHypnogram = (containerNode, data) => {\n  createHypnogram(containerNode, data, 'Hypnogram', ['Classifier'], [COMPARATIVE_COLORS.Classifier]);\n};\n\nexport const createComparativeHypnogram = (containerNode, data, hypnogramNames) => {\n  createHypnogram(\n    containerNode,\n    data,\n    `Agreement between ${hypnogramNames[0]} and ${hypnogramNames[1]}`,\n    hypnogramNames,\n    hypnogramNames.map((x) => COMPARATIVE_COLORS[x]),\n  );\n};\n","import { createGlobalState } from 'react-hooks-global-state';\n\nconst { useGlobalState } = createGlobalState({\n  response: null,\n  isFormSubmitted: false,\n  postFormError: null,\n});\n\nexport default useGlobalState;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport D3Component from './d3component';\n\nconst D3ComponentScrollyTelling = ({\n  callback,\n  data,\n  isInitialized,\n  setIsInitialized,\n  useDiv = false,\n}) => {\n  const createCallback = (svg, data) => {\n    if (!isInitialized) {\n      setIsInitialized(true);\n      callback(svg, data);\n    }\n  };\n\n  return <D3Component callback={createCallback} data={data} useDiv={useDiv} />;\n};\n\nD3ComponentScrollyTelling.propTypes = {\n  callback: PropTypes.func.isRequired,\n  isInitialized: PropTypes.bool,\n  setIsInitialized: PropTypes.func,\n  data: PropTypes.any,\n  // Using a div node instead of a svg node allows usage of child components of other types:\n  // i.g., for performance issues, we used both canvas & svg child elements in a visualisation.\n  useDiv: PropTypes.bool,\n};\n\nexport default D3ComponentScrollyTelling;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Waypoint } from 'react-waypoint';\n\nconst WaypointDirection = ({ onUp = () => {}, onDown = () => {} }) => (\n  <Waypoint\n    onEnter={({ previousPosition }) => (previousPosition === Waypoint.below ? onDown() : onUp())}\n    bottomOffset=\"99%\"\n    fireOnRapidScroll\n  />\n);\n\nWaypointDirection.propTypes = {\n  onUp: PropTypes.func.isRequired,\n  onDown: PropTypes.func.isRequired,\n};\n\nexport default WaypointDirection;\n","import _ from 'lodash';\n\nimport { convertAPIFormatToCSVFormat, convertTimestampsToDates, convertEpochsToAnnotations } from '../utils';\nimport { STAGES_ORDERED } from '../constants';\n\nexport const preprocessData = (data) => {\n  data = convertAPIFormatToCSVFormat(data);\n  data = convertTimestampsToDates(data);\n  const annotations = convertEpochsToAnnotations(data);\n  const stageTimeProportions = getStageTimeProportions(data);\n  const firstStageIndexes = findFirstStageIndex(annotations);\n\n  return {\n    epochs: data,\n    annotations,\n    stageTimeProportions,\n    firstStageIndexes,\n  };\n};\n\nconst getStageTimeProportions = (data) => {\n  const nbEpochPerSleepStage = _.countBy(data.map((x) => x.sleepStage));\n  const proportionPerSleepStage = _.mapValues(nbEpochPerSleepStage, (countPerStage) => countPerStage / data.length);\n\n  return proportionPerSleepStage;\n};\n\n//Finds the index of the first element of each sleep stage (for Viz 3)\nconst findFirstStageIndex = (annotations) =>\n  STAGES_ORDERED.reduce(\n    (firstStageIndexes, stage) =>\n      Object({\n        ...firstStageIndexes,\n        [stage]: annotations.findIndex((element) => element.stage === stage),\n      }),\n    {},\n  );\n","import { STAGES_ORDERED } from '../constants';\n\nexport const CANVAS_DIMENSION = {\n  WIDTH: 1000,\n  HEIGHT: 600,\n};\nexport const MARGIN = {\n  TOP: 90,\n  RIGHT: 70,\n  BOTTOM: 50,\n  LEFT: 70,\n};\nexport const DIMENSION = {\n  WIDTH: CANVAS_DIMENSION.WIDTH - MARGIN.LEFT - MARGIN.RIGHT,\n  HEIGHT: CANVAS_DIMENSION.HEIGHT - MARGIN.TOP - MARGIN.BOTTOM,\n};\n\nexport const BAR_HEIGHT = DIMENSION.HEIGHT / STAGES_ORDERED.length;\n","import { STAGES_ORDERED } from 'd3/constants';\nimport { MARGIN } from './constants';\n\nconst SQUARE_SIZE = 20;\nconst LABEL_Y_OFFSET = 55;\nconst COLOR_Y_OFFSET = 40;\nconst MAP_STAGE_TO_LABEL_OFFSET = {\n  W: 0,\n  REM: 55,\n  N1: 135,\n  N2: 200,\n  N3: 270,\n};\nconst MAP_STAGE_TO_COLOR_OFFSET = {\n  W: MAP_STAGE_TO_LABEL_OFFSET.W + 25,\n  REM: MAP_STAGE_TO_LABEL_OFFSET.REM + 50,\n  N1: MAP_STAGE_TO_LABEL_OFFSET.N1 + 35,\n  N2: MAP_STAGE_TO_LABEL_OFFSET.N2 + 35,\n  N3: MAP_STAGE_TO_LABEL_OFFSET.N3 + 35,\n};\n\nexport const createLegend = (svg, color) => {\n  svg\n    .selectAll('names')\n    .data(STAGES_ORDERED)\n    .enter()\n    .append('text')\n    .attr('class', 'legend')\n    .attr('x', (stage) => MAP_STAGE_TO_LABEL_OFFSET[stage])\n    .attr('y', LABEL_Y_OFFSET)\n    .text((d) => d)\n    .style('fill', (_, i) => color(i))\n    .style('font-size', '20px')\n    .attr('text-anchor', 'left')\n    .style('alignment-baseline', 'middle')\n    .attr('transform', `translate(${MARGIN.LEFT}, 0)`);\n\n  svg\n    .selectAll('dots')\n    .data(STAGES_ORDERED)\n    .enter()\n    .append('rect')\n    .attr('class', 'legend')\n    .attr('x', (stage) => MAP_STAGE_TO_COLOR_OFFSET[stage])\n    .attr('y', COLOR_Y_OFFSET)\n    .attr('width', SQUARE_SIZE)\n    .attr('height', SQUARE_SIZE)\n    .style('fill', (_, i) => color(i))\n    .attr('transform', `translate(${MARGIN.LEFT}, 0)`);\n};\n","import * as d3 from 'd3';\nimport _ from 'lodash';\nimport { DateTime } from 'luxon';\n\nimport { BAR_HEIGHT, DIMENSION } from './constants';\nimport { EPOCH_DURATION_MS, TRANSITION_TIME_MS, STAGES_ORDERED } from '../constants';\n\nimport '../style.css';\n\nexport const createTimelineChartCallbacks = (g, xTime, xTimeAxis, color, tooltip) =>\n  Object({\n    fromInitial: () => {\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n\n      setAttrOnAnnotationRects(annotationRects, xTime, 0, color, tooltip);\n\n      g.append('g')\n        .attr('class', 'x visualization__axis')\n        .attr('transform', `translate(0, ${BAR_HEIGHT})`)\n        .call(xTimeAxis);\n    },\n    fromInstance: () => {\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n\n      g.selectAll('.y.visualization__axis').remove();\n\n      setAttrOnAnnotationRects(annotationRects, xTime, 0, color, tooltip);\n\n      transitionHorizontalAxis(g, BAR_HEIGHT);\n    },\n  });\n\nexport const createInstanceChartCallbacks = (g, data, xTime, xTimeAxis, yAxis, color, tooltip) =>\n  Object({\n    fromTimeline: () => {\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n\n      createVerticalAxis(g, yAxis, color);\n      transitionHorizontalAxis(g, STAGES_ORDERED.length * BAR_HEIGHT);\n      setAttrOnAnnotationRects(annotationRects, xTime, getVerticalPositionCallback, color, tooltip);\n    },\n    fromBarChart: () => {\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n      const xProportionCallback = getOffsetSleepStageProportionCallback(data);\n      annotationRects.attr('x', xProportionCallback).attr('width', ({ end, start }) => xTime(end) - xTime(start));\n\n      g.selectAll('text.proportion').remove();\n\n      g.select('.x.visualization__axis').interrupt().transition().call(xTimeAxis);\n      transitionHorizontalAxis(g, STAGES_ORDERED.length * BAR_HEIGHT);\n\n      setAttrOnAnnotationRects(annotationRects, xTime, getVerticalPositionCallback, color, tooltip);\n    },\n  });\n\nexport const createBarChartCallbacks = (g, data, xAxisLinear, yAxis, color, tip) =>\n  Object({\n    fromInstance: () => {\n      const { firstStageIndexes, stageTimeProportions } = data;\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n      const xProportionCallback = getOffsetSleepStageProportionCallback(data);\n\n      g.select('.x.visualization__axis').transition().call(xAxisLinear);\n      transitionHorizontalAxis(g, STAGES_ORDERED.length * BAR_HEIGHT);\n\n      setTooltip(annotationRects, tip)\n        .transition()\n        .duration(TRANSITION_TIME_MS)\n        .attr('y', getVerticalPositionCallback)\n        .attr('x', xProportionCallback)\n        .on('end', () => {\n          // Only keep the first rectangle of each stage to be visible\n          g.selectAll('.rect-stacked')\n            .attr('x', 0)\n            .attr('width', getFirstRectangleProportionWidthCallback(firstStageIndexes, stageTimeProportions));\n          createProportionLabels(g, data);\n        });\n    },\n    fromStackedBarChart: () => {\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n      g.selectAll('text.proportion').remove();\n\n      createVerticalAxis(g, yAxis, color);\n      transitionHorizontalAxis(g, STAGES_ORDERED.length * BAR_HEIGHT);\n\n      annotationRects\n        .transition()\n        .duration(TRANSITION_TIME_MS / 2)\n        .attr('y', (d) => BAR_HEIGHT * STAGES_ORDERED.indexOf(d.stage))\n        .transition()\n        .duration(TRANSITION_TIME_MS / 2)\n        .attr('x', 0)\n        .on('end', () => createProportionLabels(g, data));\n    },\n  });\n\nexport const createStackedBarChartCallbacks = (g, data) =>\n  Object({\n    fromBarChart: () => {\n      const { annotations, firstStageIndexes, stageTimeProportions, epochs } = data;\n      const firstAnnotationsByStage = _.filter(annotations, ({ stage }, index) => firstStageIndexes[stage] === index);\n      const getHorizontalPositionSleepStage = ({ stage }) =>\n        (getCumulativeProportionOfNightAtStart(stage, stageTimeProportions) + stageTimeProportions[stage] / 2) *\n        DIMENSION.WIDTH;\n      const annotationRects = g.selectAll('.rect-stacked').interrupt();\n\n      g.selectAll('.y.visualization__axis').remove();\n      g.selectAll('text.proportion').remove();\n\n      transitionHorizontalAxis(g, BAR_HEIGHT);\n\n      annotationRects\n        .transition()\n        .duration(TRANSITION_TIME_MS / 2)\n        .attr('x', ({ stage }) => getCumulativeProportionOfNightAtStart(stage, stageTimeProportions) * DIMENSION.WIDTH)\n        .attr('width', getFirstRectangleProportionWidthCallback(firstStageIndexes, stageTimeProportions))\n        .transition()\n        .duration(TRANSITION_TIME_MS / 2)\n        .attr('y', 0);\n\n      g.selectAll('.text')\n        .data(firstAnnotationsByStage)\n        .enter()\n        .append('text')\n        .attr('class', 'proportion')\n        .style('text-anchor', 'middle')\n        .append('tspan')\n        .text(({ stage }) =>\n          DateTime.fromMillis(stageTimeProportions[stage] * epochs.length * EPOCH_DURATION_MS)\n            .toUTC()\n            .toFormat('hh:mm:ss'),\n        )\n        .attr('x', getHorizontalPositionSleepStage)\n        .attr('y', 40)\n        .append('tspan')\n        .text(({ stage }) => `${_.round(stageTimeProportions[stage] * 100, 2)}%`)\n        .attr('x', getHorizontalPositionSleepStage)\n        .attr('y', 60);\n    },\n  });\n\nconst setAttrOnAnnotationRects = (annotationRects, x, yPosition, color, tooltip) =>\n  setTooltip(annotationRects, tooltip)\n    .attr('height', BAR_HEIGHT)\n    .transition()\n    .duration(TRANSITION_TIME_MS)\n    .attr('x', ({ start }) => x(start))\n    .attr('y', yPosition)\n    .attr('width', ({ end, start }) => x(end) - x(start))\n    .attr('fill', ({ stage }) => color(stage));\n\nconst setTooltip = (element, tooltip) =>\n  element\n    .on('mouseover', function (d) {\n      tooltip.show(d, this);\n      d3.select(this).style('opacity', 0.8);\n    })\n    .on('mouseout', function () {\n      tooltip.hide();\n      d3.select(this).style('opacity', 1);\n    });\n\nconst getVerticalPositionCallback = (d) => BAR_HEIGHT * STAGES_ORDERED.indexOf(d.stage);\n\nconst getFirstRectangleProportionWidthCallback = (firstStageIndexes, stageTimeProportions) => ({ stage }, i) =>\n  i === firstStageIndexes[stage] ? stageTimeProportions[stage] * DIMENSION.WIDTH : 0;\n\nconst createVerticalAxis = (g, yAxis, color) =>\n  g\n    .append('g')\n    .attr('class', 'y visualization__axis')\n    .style('font-size', '1.5rem')\n    .transition()\n    .duration(TRANSITION_TIME_MS)\n    .call(yAxis)\n    .selectAll('text')\n    .attr('class', 'y-label')\n    .attr('y', BAR_HEIGHT / 2)\n    .attr('x', -10)\n    .style('fill', (d) => color(d))\n    .attr('text-anchor', 'left')\n    .style('alignment-baseline', 'middle');\n\nconst transitionHorizontalAxis = (g, yPosition) =>\n  g\n    .select('.x.visualization__axis')\n    .transition()\n    .duration(TRANSITION_TIME_MS)\n    .attr('transform', `translate(0, ${yPosition})`);\n\nconst createProportionLabels = (g, data) =>\n  g\n    .selectAll('text.proportion')\n    .data(data.annotations)\n    .enter()\n    .append('text')\n    .attr('class', 'proportion')\n    .text(({ stage }, i) =>\n      i === data.firstStageIndexes[stage] ? `${_.round(data.stageTimeProportions[stage] * 100, 2)}%` : '',\n    )\n    .attr('x', DIMENSION.WIDTH / 20)\n    .attr('y', ({ stage }) => BAR_HEIGHT * STAGES_ORDERED.indexOf(stage) + BAR_HEIGHT / 2)\n    .style('fill', 'black');\n\nconst getCumulativeProportionOfNightAtStart = (stage, totalStageProportions) =>\n  _.sum(\n    _.slice(\n      STAGES_ORDERED.map((stage_ordered) => totalStageProportions[stage_ordered]),\n      0,\n      _.indexOf(STAGES_ORDERED, stage),\n    ),\n  );\n\nconst getOffsetSleepStageProportionCallback = (data) => {\n  const { annotations, stageTimeProportions } = data;\n  const cumulSumProportions = cumulSum(\n    _.mapValues(stageTimeProportions, (proportion, stage) =>\n      _.filter(annotations, (d) => d.stage === stage).map((annotation) => annotation.proportion / proportion),\n    ),\n  );\n  const annotationIndexSleepStage = annotations.map((annotation) => {\n    return _.indexOf(\n      _.filter(annotations, (d) => d.stage === annotation.stage),\n      annotation,\n    );\n  });\n\n  return (d, index) =>\n    DIMENSION.WIDTH * stageTimeProportions[d.stage] * cumulSumProportions[d.stage][annotationIndexSleepStage[index]];\n};\n\nconst cumulSum = (annotationsProportionByStage) =>\n  _.mapValues(annotationsProportionByStage, (annotationsProportion) => {\n    const currentCumulSum = [0];\n    annotationsProportion.forEach((proportion, index) => {\n      if (index !== annotationsProportion.length - 1) {\n        currentCumulSum.push(proportion + currentCumulSum[index]);\n      }\n    });\n    return currentCumulSum;\n  });\n","import tip from 'd3-tip';\nimport './style.css';\n\nimport { EPOCH_DURATION_MS } from '../constants';\nimport { DateTime, Duration } from 'luxon';\n\nexport const initializeTooltips = (svg, data) => {\n  const barToolTip = initializeTooltip(svg, getBarToolTipText);\n  const stackedToolTip = initializeTooltip(svg, (d) =>\n    getStackedToolTipText(d, data.stageTimeProportions, data.epochs.length),\n  );\n\n  return { barToolTip, stackedToolTip };\n};\n\nconst initializeTooltip = (svg, getToolTipText) => {\n  const tooltip = tip().attr('class', 'evolving_chart__tooltip').offset([-10, 0]);\n  svg.call(tooltip);\n  tooltip.html(getToolTipText);\n\n  return tooltip;\n};\n\nconst getBarToolTipText = (d) => `Stage : <strong> ${d.stage} </strong> <br>\n            Range  :  <strong> ${DateTime.fromJSDate(d.start).toFormat('hh:mm:ss')} </strong>\n              - <strong> ${DateTime.fromJSDate(d.end).toFormat('hh:mm:ss')} </strong> <br>\n            Duration: <strong> ${DateTime.fromJSDate(d.end)\n              .diff(DateTime.fromJSDate(d.start))\n              .toFormat('hh:mm:ss')} </strong>`;\n\nconst getStackedToolTipText = (d, stageTimeProportions, nbEpochs) =>\n  `Stage : <strong> ${d.stage} </strong><br>  Duration : <strong> ${Duration.fromMillis(\n    stageTimeProportions[d.stage] * nbEpochs * EPOCH_DURATION_MS,\n  ).toFormat('hh:mm:ss')} </strong><br>`;\n","import * as d3 from 'd3';\nimport _ from 'lodash';\nimport { DateTime } from 'luxon';\n\nimport { preprocessData } from './preproc';\nimport { createLegend } from './legend';\nimport {\n  createTimelineChartCallbacks,\n  createInstanceChartCallbacks,\n  createBarChartCallbacks,\n  createStackedBarChartCallbacks,\n} from './chart_states';\nimport { MARGIN, CANVAS_DIMENSION, BAR_HEIGHT, DIMENSION } from './constants';\nimport { STAGES_ORDERED, STAGE_TO_COLOR } from '../constants';\nimport { initializeTooltips } from './mouse_over';\n\nexport let instanceChartCallbacks = {};\nexport let timelineChartCallbacks = {};\nexport let barChartCallbacks = {};\nexport let stackedBarChartCallbacks = {};\n\nconst initializeScales = () => {\n  const { WIDTH, HEIGHT } = DIMENSION;\n  const xTime = d3.scaleTime([0, WIDTH]);\n  const xLinear = d3.scaleLinear([0, WIDTH]);\n  const y = d3.scaleOrdinal(_.range(0, HEIGHT + 1, BAR_HEIGHT));\n  const colors = d3.scaleOrdinal(STAGES_ORDERED.map((x) => STAGE_TO_COLOR[x]));\n\n  return { xTime, xLinear, y, colors };\n};\n\nconst setDomainOnScales = (xTime, xLinear, y, colors, epochs) => {\n  const start = _.first(epochs).timestamp;\n  const end = _.last(epochs).timestamp;\n  const nightDuration = DateTime.fromJSDate(end).diff(DateTime.fromJSDate(start), ['hours']);\n\n  xTime.domain([start, end]);\n  xLinear.domain([0, nightDuration.hours]);\n  y.domain(STAGES_ORDERED);\n  colors.domain(STAGES_ORDERED);\n};\n\nconst initializeAxes = (xTime, xLinear, y) => {\n  const xTimeAxis = d3.axisBottom(xTime).tickFormat((d) => `${d.getHours()}h`);\n  const xLinearAxis = d3.axisBottom(xLinear).tickFormat((d) => `${d}h`);\n  const yAxis = d3.axisLeft(y).tickSize(-DIMENSION.WIDTH); //will create the lines in second visualisation\n\n  return { xTimeAxis, xLinearAxis, yAxis };\n};\n\nconst createDrawingGroup = (svg) => svg.append('g').attr('transform', `translate(${MARGIN.LEFT}, ${MARGIN.TOP})`);\n\nconst bindAnnotationsToRects = (g, annotations) =>\n  g.selectAll('.rect').data(annotations).enter().append('rect').attr('class', 'rect-stacked');\n\nconst createEvolvingChart = (containerNode, data) => {\n  const svg = d3.select(containerNode).attr('viewBox', `0, 0, ${CANVAS_DIMENSION.WIDTH}, ${CANVAS_DIMENSION.HEIGHT}`);\n  const { xTime, xLinear, y, colors } = initializeScales();\n  const { xTimeAxis, xLinearAxis, yAxis } = initializeAxes(xTime, xLinear, y);\n  const g = createDrawingGroup(svg);\n  createLegend(svg, colors);\n\n  data = preprocessData(data);\n\n  setDomainOnScales(xTime, xLinear, y, colors, data.epochs);\n  const { barToolTip, stackedToolTip } = initializeTooltips(svg, data);\n  bindAnnotationsToRects(g, data.annotations);\n\n  timelineChartCallbacks = createTimelineChartCallbacks(g, xTime, xTimeAxis, colors, barToolTip);\n\n  instanceChartCallbacks = createInstanceChartCallbacks(g, data, xTime, xTimeAxis, yAxis, colors, barToolTip);\n\n  barChartCallbacks = createBarChartCallbacks(g, data, xLinearAxis, yAxis, colors, stackedToolTip);\n\n  stackedBarChartCallbacks = createStackedBarChartCallbacks(g, data);\n\n  timelineChartCallbacks.fromInitial();\n};\n\nexport default createEvolvingChart;\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Container, Card, CardBody } from 'reactstrap';\n\nimport D3ComponentScrollyTelling from 'components/d3component_scrollytelling';\nimport WaypointDirection from 'components/waypoint_direction';\n\nimport createEvolvingChart, {\n  instanceChartCallbacks,\n  timelineChartCallbacks,\n  barChartCallbacks,\n  stackedBarChartCallbacks,\n} from 'd3/evolving_chart/evolving_chart';\n\nconst StackedBarChartScrollyTelling = ({ epochs }) => {\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  return (\n    <Container>\n      <div style={{ position: 'sticky', top: '10%' }}>\n        <D3ComponentScrollyTelling\n          callback={createEvolvingChart}\n          data={epochs}\n          isInitialized={isInitialized}\n          setIsInitialized={setIsInitialized}\n        />\n      </div>\n      <div style={{ marginBottom: '50%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            We can see that each colored block represents a part of your night. They are ordered from bed time to out of\n            bed timestamps you’ve written in your journal. Each color is associated with a specific sleep stage. You\n            went to bed at 12:22 am and you got out of bed at 9:47 am, which adds up to 9 hours and 25 minutes of time\n            spent in bed. Of this total time, you spent 7 hours and 27 minutes actually sleeping. You first fell asleep\n            at XX:XX, to which we will refer to as sleep onset. The last non wake block ended at XX:XX, which can also\n            be referred to as sleep offset. During that night's sleep, you went through each of the 5 five stages. Let's\n            try to see a little better what happened about each of them.\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      {isInitialized && (\n        <WaypointDirection onDown={instanceChartCallbacks.fromTimeline} onUp={timelineChartCallbacks.fromInstance} />\n      )}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>Wake stage is of course the stage we want to minimize when in bed. It can be decomposed into two parts:</p>\n          <ul>\n            <li> Sleep latency : Time spent before falling asleep, which corresponds to X minutes in your case. </li>\n            <li> Wake after sleep onset (WASO): Time spent awake after first falling asleep and before waking up. </li>\n            <li>\n              {' '}\n              For healthy adults, it is normal to experience small awakenings during the night. Unprovoked awakenings\n              are mostly during or after REM stages.{' '}\n            </li>\n          </ul>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            <strong>REM stage</strong> stands for “Rapid Eyes Movements” and is also known as “paradoxical sleep”. It is\n            associated with dreaming and, as the National Sleep Foundation says,{' '}\n            <strong>“the brain is awake and body paralyzed.”</strong>\n          </p>\n          <p>\n            <strong>N1 stage</strong> is associated with that drowsy feeling before falling asleep. Most people wouldn’t\n            say they fell asleep if they’ve been woken up from N1 sleep.\n          </p>\n          <p>\n            <strong>N2 stage</strong> still corresponds to a light sleep, but where the muscle activity decreases more,\n            and the eyes have stopped moving. It is called, along with N1, <strong>light sleep</strong>.\n          </p>\n          <p>\n            <strong>N3 stage</strong> is when you are deeply asleep, hence it’s also called <strong>deep sleep</strong>,\n            or sometimes <strong>slow wave</strong> sleep, and is the most difficult to wake up from. It is during those\n            stages that your cells get repaired, and that tissue grows. But how much time did you spend in each stage\n            during the whole night?\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      {isInitialized && (\n        <WaypointDirection onDown={barChartCallbacks.fromInstance} onUp={instanceChartCallbacks.fromBarChart} />\n      )}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            From here, we can look at your sleep efficiency, which is the proportion of time spent asleep over the\n            overall time spent in bed. In your case, it corresponds to 79%, or 7h27.\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            We are currently looking at your in bed sleep stage proportions. Wake time may be overrepresented, because\n            it includes your sleep latency and the time you spent in bed after waking up. In order to look at your\n            actual stage proportions, we must cut them out from wake time to only keep WASO.\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            We can see that the most prominent sleep stage is N2, which in your case corresponds to XXXX. How does your\n            night compare to other people’s night?\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      {isInitialized && (\n        <WaypointDirection\n          onDown={stackedBarChartCallbacks.fromBarChart}\n          onUp={barChartCallbacks.fromStackedBarChart}\n        />\n      )}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            As a rule of thumb, adults approximately stay 5% of their total sleep time in N1; 50% in N2; and 20% is in\n            N3. The remaining 25% is REM stage sleep.\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      &nbsp;\n    </Container>\n  );\n};\n\nStackedBarChartScrollyTelling.propTypes = {\n  epochs: PropTypes.object.isRequired,\n};\n\nexport default StackedBarChartScrollyTelling;\n","export const PADDING = 100;\nexport const NB_SPECTROGRAM = 2;\nexport const FREQUENCY_KEY = 'frequencies';\nexport const HYPNOGRAM_KEY = 'epochs';\nexport const NB_POINTS_COLOR_INTERPOLATION = 3;\nexport const NOT_HIGHLIGHTED_RECTANGLE_OPACITY = 0.5;\nexport const CANVAS_WIDTH_TO_HEIGHT_RATIO = 700 / 1000; // width to height ratio\nexport const CANVAS_HEIGHT_WINDOW_FACTOR = 0.8;\nexport const MARGIN = {\n  TOP: 50,\n  RIGHT: 120,\n  BOTTOM: 50,\n  LEFT: 70,\n};\nexport const TITLE_FONT_SIZE = '18px';\nexport const TITLE_POSITION_Y = -MARGIN.TOP / 3;\n","import * as d3 from 'd3';\nimport _ from 'lodash';\nimport { MARGIN, NB_POINTS_COLOR_INTERPOLATION, TITLE_FONT_SIZE, TITLE_POSITION_Y } from './constants';\n\nimport '../style.css';\n\nconst createDrawingGroups = (g, spectrogramWidth) =>\n  Object({\n    spectrogramDrawingGroup: g.append('g').attr('transform', `translate(${MARGIN.LEFT}, ${MARGIN.TOP})`),\n    legendDrawingGroup: g.append('g').attr('transform', `translate(${MARGIN.LEFT + spectrogramWidth}, ${MARGIN.TOP})`),\n  });\n\nconst drawTitle = (g, channelName, spectrogramWidth) =>\n  g\n    .append('text')\n    .attr('x', spectrogramWidth / 2)\n    .attr('y', TITLE_POSITION_Y)\n    .style('text-anchor', 'middle')\n    .style('font-size', TITLE_FONT_SIZE)\n    .text(`Spectrogram of channel ${channelName}`);\n\nconst drawAxes = (g, xAxis, yAxis, singleSpectrogramHeight, spectrogramWidth) => {\n  g.append('text')\n    .attr('class', 'x visualization__axis')\n    .attr('y', singleSpectrogramHeight + MARGIN.BOTTOM)\n    .attr('x', spectrogramWidth / 2)\n    .attr('fill', 'currentColor')\n    .style('text-anchor', 'middle')\n    .text('Time');\n\n  g.append('text')\n    .attr('class', 'y visualization__axis')\n    .attr('transform', 'rotate(-90)')\n    .attr('y', -MARGIN.LEFT)\n    .attr('x', -singleSpectrogramHeight / 2)\n    .attr('dy', '1em')\n    .attr('fill', 'currentColor')\n    .style('text-anchor', 'middle')\n    .text('Frequency (Hz)');\n\n  g.append('g')\n    .attr('class', 'x visualization__axis')\n    .attr('transform', `translate(0, ${singleSpectrogramHeight})`)\n    .call(xAxis)\n    .selectAll('text');\n\n  g.append('g').attr('class', 'y visualization__axis').call(yAxis).selectAll('text');\n};\n\nconst drawLegend = (svg, color, y, spectrogramHeight) => {\n  const interpolate = d3.interpolate(color.domain()[0], color.domain()[1]);\n\n  const colors = _.map(_.range(NB_POINTS_COLOR_INTERPOLATION + 1), (x) =>\n    color(interpolate(x / NB_POINTS_COLOR_INTERPOLATION)),\n  );\n\n  const svgDefs = svg.append('defs');\n  const GRADIENT_ID = 'mainGradient';\n\n  svgDefs\n    .append('linearGradient')\n    .attr('id', GRADIENT_ID)\n    .attr('x1', '0%')\n    .attr('x2', '0%')\n    .attr('y1', '100%')\n    .attr('y2', '0%')\n    .selectAll('stop')\n    .data(colors)\n    .enter()\n    .append('stop')\n    .attr('stop-color', (d) => d)\n    .attr('offset', (_, i) => i / (colors.length - 1));\n  svg\n    .append('rect')\n    .attr('fill', `url(#${GRADIENT_ID})`)\n    .attr('x', MARGIN.RIGHT / 10)\n    .attr('y', 0)\n    .attr('width', MARGIN.RIGHT / 6)\n    .attr('height', spectrogramHeight);\n\n  const yAxis = d3.axisRight(y).ticks(5, 's');\n  svg\n    .append('g')\n    .attr('class', 'y visualization__axis')\n    .attr('transform', `translate(${MARGIN.RIGHT / 3.7},0)`)\n    .call(yAxis)\n    .selectAll('text');\n\n  svg\n    .append('text')\n    .attr('class', 'y visualization__axis')\n    .attr('transform', 'rotate(90)')\n    .attr('y', -MARGIN.RIGHT)\n    .attr('x', spectrogramHeight / 2)\n    .attr('dy', '1em')\n    .attr('fill', 'currentColor')\n    .style('text-anchor', 'middle')\n    .text('Power (uV²/Hz)');\n};\n\nconst drawSpectrogramAxesAndLegend = (\n  svg,\n  scalesAndAxesBySpectrogram,\n  data,\n  { canvasWidth, spectrogramWidth, singleSpectrogramCanvasHeight, singleSpectrogramHeight },\n) =>\n  _.forEach(_.zip(scalesAndAxesBySpectrogram, data), ([{ xAxis, yAxis, color, yColor }, { channel }], index) => {\n    const currentSpectrogramDrawingGroup = svg\n      .append('g')\n      .attr('transform', `translate(0, ${index * singleSpectrogramCanvasHeight[index]})`)\n      .attr('width', canvasWidth)\n      .attr('height', singleSpectrogramCanvasHeight[index]);\n\n    const { spectrogramDrawingGroup, legendDrawingGroup } = createDrawingGroups(\n      currentSpectrogramDrawingGroup,\n      spectrogramWidth,\n    );\n\n    drawTitle(spectrogramDrawingGroup, channel, spectrogramWidth);\n    drawAxes(spectrogramDrawingGroup, xAxis, yAxis, singleSpectrogramHeight, spectrogramWidth);\n    drawLegend(legendDrawingGroup, color, yColor, singleSpectrogramHeight);\n  });\n\nexport default drawSpectrogramAxesAndLegend;\n","import * as d3 from 'd3';\nimport _ from 'lodash';\n\nimport {\n  MARGIN,\n  CANVAS_WIDTH_TO_HEIGHT_RATIO,\n  FREQUENCY_KEY,\n  HYPNOGRAM_KEY,\n  NB_SPECTROGRAM,\n  PADDING,\n  CANVAS_HEIGHT_WINDOW_FACTOR,\n  NOT_HIGHLIGHTED_RECTANGLE_OPACITY,\n} from './constants';\nimport { STAGES_ORDERED } from '../constants';\nimport drawSpectrogramAxesAndLegend from './axes_legend';\nimport { convertAPIFormatToCSVFormat, convertTimestampsToDates } from '../utils';\n\n// keys are the sleep stage for which we want to display the spectrogram\n// accepted keys are: null (when all stages are highlighted), W, N1, N2, N3, REM\nexport let spectrogramCallbacks = {};\n\nconst getDimensions = (parentDiv) => {\n  const canvasWidth = parentDiv.node().getBoundingClientRect().width;\n  const canvasHeight = Math.min(\n    canvasWidth * CANVAS_WIDTH_TO_HEIGHT_RATIO,\n    window.innerHeight * CANVAS_HEIGHT_WINDOW_FACTOR,\n  );\n  const spectrogramsHeight = canvasHeight - MARGIN.TOP - MARGIN.BOTTOM;\n  const singleSpectrogramCanvasHeight = _.range(NB_SPECTROGRAM).map((x) => {\n    let height = spectrogramsHeight / NB_SPECTROGRAM;\n    if (x === 0) {\n      height += MARGIN.TOP;\n    } else if (x === NB_SPECTROGRAM - 1) {\n      height += MARGIN.BOTTOM;\n    }\n    return height;\n  });\n\n  return {\n    canvasWidth,\n    canvasHeight,\n    spectrogramsHeight,\n    singleSpectrogramCanvasHeight,\n    spectrogramWidth: canvasWidth - MARGIN.LEFT - MARGIN.RIGHT,\n    singleSpectrogramHeight: (spectrogramsHeight - PADDING) / NB_SPECTROGRAM,\n  };\n};\n\nconst preprocessData = (channel, data) => {\n  const powerAmplitudesByTimestamp = data[channel];\n  const frequencies = data[FREQUENCY_KEY];\n  const epochs = convertAPIFormatToCSVFormat(data.epochs);\n  const hypnogram = convertTimestampsToDates(epochs);\n\n  return {\n    channel,\n    frequencies,\n    rectangles: _.flatMap(\n      _.zip(powerAmplitudesByTimestamp, hypnogram),\n      ([powerAmplitudeSingleTimestamp, { sleepStage, timestamp }]) =>\n        _.map(_.zip(powerAmplitudeSingleTimestamp, frequencies), ([intensity, frequency]) =>\n          Object({\n            intensity,\n            frequency,\n            timestamp,\n            sleepStage,\n          }),\n        ),\n    ),\n  };\n};\n\nconst initializeScales = ({ spectrogramWidth, singleSpectrogramHeight }) =>\n  Object({\n    x: d3.scaleTime([0, spectrogramWidth]),\n    yLinear: d3.scaleLinear([singleSpectrogramHeight, 0]),\n    yBand: d3.scaleBand([singleSpectrogramHeight, 0]),\n    yColor: d3.scaleLinear([singleSpectrogramHeight, 0]),\n    color: d3.scaleSequential().interpolator(d3.interpolatePlasma),\n  });\n\nconst setDomainOnScales = ({ rectangles, frequencies }, x, yBand, yLinear, color, yColor) => {\n  x.domain([_.first(rectangles).timestamp, _.last(rectangles).timestamp]);\n  yBand.domain(frequencies);\n  yLinear.domain([_.first(frequencies), _.last(frequencies)]);\n  color.domain(d3.extent(rectangles, ({ intensity }) => intensity));\n  yColor.domain(d3.extent(rectangles, ({ intensity }) => intensity));\n};\n\nconst initializeAxes = (x, y) =>\n  Object({\n    xAxis: d3.axisBottom(x).tickFormat((d) => `${d.getHours()}h`),\n    yAxis: d3.axisLeft(y).ticks(5, 's'),\n  });\n\nconst getScalesAndAxes = (data, dimensions) => {\n  const { x, yLinear, yBand, yColor, color } = initializeScales(dimensions);\n  const { xAxis, yAxis } = initializeAxes(x, yLinear);\n\n  setDomainOnScales(data, x, yBand, yLinear, color, yColor);\n\n  return { x, yBand, yColor, color, xAxis, yAxis };\n};\n\nconst drawSpectrogramRectangles = (\n  canvas,\n  scalesAndAxesBySpectrogram,\n  data,\n  { singleSpectrogramCanvasHeight },\n  highlightedSleepStage,\n) => {\n  const context = canvas.node().getContext('2d');\n  const isHighlighted = (sleepStage) => highlightedSleepStage === null || highlightedSleepStage === sleepStage;\n\n  _.each(_.zip(scalesAndAxesBySpectrogram, data), ([{ x, yBand, color }, { rectangles, frequencies }], index) => {\n    const rectangleWidth = x(rectangles[frequencies.length].timestamp) - x(rectangles[0].timestamp);\n\n    context.resetTransform();\n    context.translate(MARGIN.LEFT, MARGIN.TOP + index * singleSpectrogramCanvasHeight[index]);\n\n    _.each(rectangles, ({ timestamp, frequency, intensity, sleepStage }) => {\n      context.beginPath();\n      context.fillRect(x(timestamp), yBand(frequency), rectangleWidth, yBand.bandwidth());\n      context.globalAlpha = isHighlighted(sleepStage) ? 1 : NOT_HIGHLIGHTED_RECTANGLE_OPACITY;\n      context.fillStyle = color(intensity);\n      context.fill();\n      context.stroke();\n    });\n  });\n};\n\nconst createSpectrogram = (containerNode, data) => {\n  /*\n  Considering the number of rectangles to display is well over 1k,\n  we will use a canvas instead of a svg element to display the visualisation.\n  (https://stackoverflow.com/a/50143500).\n  We will seperatly create the axes and legend, overlaid over the canvas element, because d3-axis\n  module was only conceived to be used inside a svg element.\n  We have done so by setting the same dimensions to both svg and canvas, and then by\n  setting the first element's position, in this case the canvas, to absolute.\n  */\n  const parentDiv = d3.select(containerNode);\n  const dimensions = getDimensions(parentDiv);\n\n  const canvas = parentDiv\n    .append('canvas')\n    .attr('width', dimensions.canvasWidth)\n    .attr('height', dimensions.canvasHeight)\n    .style('position', 'absolute');\n  const svg = parentDiv.append('svg').attr('width', dimensions.canvasWidth).attr('height', dimensions.canvasHeight);\n\n  const channelNames = _.filter(_.keys(data), (keyName) => !_.includes([FREQUENCY_KEY, HYPNOGRAM_KEY], keyName));\n  const preprocessedData = _.map(channelNames, (channel) => preprocessData(channel, data));\n  const scalesAndAxesBySpectrogram = _.map(preprocessedData, (data) => getScalesAndAxes(data, dimensions));\n\n  const createSpectrogramWithHighlightedStageCallback = (highlightedSleepStage) => () => {\n    const ctx = canvas.node().getContext('2d');\n    ctx.resetTransform();\n    ctx.clearRect(0, 0, dimensions.canvasWidth, dimensions.canvasHeight);\n    ctx.stroke();\n\n    svg.selectAll('*').remove();\n\n    drawSpectrogramRectangles(canvas, scalesAndAxesBySpectrogram, preprocessedData, dimensions, highlightedSleepStage);\n    drawSpectrogramAxesAndLegend(svg, scalesAndAxesBySpectrogram, preprocessedData, dimensions);\n  };\n\n  spectrogramCallbacks = _.zipObject(\n    [null, ...STAGES_ORDERED],\n    _.map([null, ...STAGES_ORDERED], (stage) => createSpectrogramWithHighlightedStageCallback(stage)),\n  );\n  spectrogramCallbacks[null]();\n};\n\nexport default createSpectrogram;\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Container, Card, CardBody } from 'reactstrap';\n\nimport createSpectrogram, { spectrogramCallbacks } from '../../d3/spectrogram/spectrogram';\nimport D3ComponentScrollyTelling from '../../components/d3component_scrollytelling';\nimport WaypointDirection from '../../components/waypoint_direction';\n\nconst SpectrogramScrollyTelling = ({ spectrograms, epochs }) => {\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  return (\n    <Container>\n      <div style={{ position: 'sticky', top: '10%' }}>\n        <D3ComponentScrollyTelling\n          callback={createSpectrogram}\n          data={{ ...spectrograms, epochs }}\n          isInitialized={isInitialized}\n          setIsInitialized={setIsInitialized}\n          useDiv\n        />\n      </div>\n      <div style={{ marginBottom: '50%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            Here is represented spectrograms of both your EEG channels. Spectrograms can be viewed as if we took all of\n            your nights signal, we’ve separated it in contiguous 30 seconds chunks, stacked then horizontally and to\n            which we’ve applied the fast fourier transform. We then have, for each 30 seconds epoch, the corresponding\n            amplitudes for each frequency that makes up the signal, hence the spectra.\n          </p>\n          <p>\n            We then converted the scale to logarithmic, to better see the differences in the spectrums. We then speak of\n            signal power instead of signal amplitude, because we look at the spectrums in a logarithmic scale.\n          </p>\n          <h5>How to read it?</h5>\n          <p>\n            Red therefore means that in that 30 seconds time frame, that particular frequency had a big amplitude. Green\n            means that you had that frequency with a lower amplitude. Dark blue means that you didn’t have that\n            frequency in the signal.\n          </p>\n          <p>\n            To get a better understanding at how spectrograms work, you can{' '}\n            <a href=\"https://musiclab.chromeexperiments.com/Spectrogram/\" rel=\"noopener noreferrer\" target=\"_blank\">\n              check out this example\n            </a>{' '}\n            that decomposes sound frequency from your microphone.\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            Generally, when talking about brain waves, we group certain frequencies together into bands. There are\n            overall five frequency bands, where each has a general associated behaviour, or state of mind. We will cover\n            those when looking at time frames corresponding to each sleep stage.\n          </p>\n        </CardBody>\n      </Card>\n      {isInitialized && <WaypointDirection onDown={spectrogramCallbacks['W']} onUp={spectrogramCallbacks[null]} />}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            We can associate wake stages with low-amplitude activity in the 15 to 60 Hz frequency range, called the beta\n            band. [6]\n          </p>\n        </CardBody>\n      </Card>\n      {isInitialized && <WaypointDirection onDown={spectrogramCallbacks['N1']} onUp={spectrogramCallbacks['W']} />}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            By slowly falling asleep, the signal frequencies tend to decrease into the 4 to 8 Hz range, or the theta\n            band, and to have larger amplitudes. These characteristics are associated with N1.\n          </p>\n        </CardBody>\n      </Card>\n      {isInitialized && <WaypointDirection onDown={spectrogramCallbacks['N2']} onUp={spectrogramCallbacks['N1']} />}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            N2 stage has the same characteristics as N1, and also includes sleep spindles. They last only a few seconds\n            and are a large oscillation in the 10 to 15 hz band. Because they do not occur during all of the 30 seconds\n            period, they cannot be seen here. [6]\n          </p>\n        </CardBody>\n      </Card>\n      {isInitialized && <WaypointDirection onDown={spectrogramCallbacks['N3']} onUp={spectrogramCallbacks['N2']} />}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            Stage N3, also called slow wave sleep, is characterized by slower waves between 0.5 and 4 Hz, known as the\n            delta range, with large amplitudes. [6]\n          </p>\n        </CardBody>\n      </Card>\n      {isInitialized && <WaypointDirection onDown={spectrogramCallbacks['REM']} onUp={spectrogramCallbacks['N3']} />}\n      <div style={{ marginBottom: '125%' }} />\n      <Card className=\"shadow\" style={{ position: 'relative' }}>\n        <CardBody>\n          <p>\n            REM stage has the same characteristics as Wake stage, whereas there are low voltage high frequency activity.\n            [6]\n          </p>\n        </CardBody>\n      </Card>\n      <div style={{ marginBottom: '125%' }} />\n      &nbsp;\n    </Container>\n  );\n};\n\nSpectrogramScrollyTelling.propTypes = {\n  spectrograms: PropTypes.object.isRequired,\n  epochs: PropTypes.object.isRequired,\n};\n\nexport default SpectrogramScrollyTelling;\n","import React from 'react';\nimport { Container, Row, Button } from 'reactstrap';\nimport { Link, Redirect } from 'react-router-dom';\n\nimport Header from 'components/header';\nimport D3Component from 'components/d3component';\nimport WIPWarning from 'components/wip_warning';\n\nimport { createSingleHypnogram } from 'd3/hypnogram/hypnogram';\n\nimport useGlobalState from 'hooks/useGlobalState';\nimport text from './text.json';\nimport StackedBarChartScrollyTelling from './stacked_bar_chart_scrollytelling';\nimport SpectrogramScrollyTelling from './spectrogram_scrollytelling';\n\nimport './style.css';\n\nconst SleepAnalysisResults = () => {\n  const [response] = useGlobalState('response');\n  if (!response) {\n    return (\n      <Redirect\n        to={{\n          pathname: '/analyze-my-sleep',\n        }}\n      />\n    );\n  }\n  const data = response.data;\n  const encodedJsonEpochs = encodeURIComponent(JSON.stringify(data.epochs));\n\n  return (\n    <div>\n      <Header\n        sizeClass={'pb-150'}\n        shapeQty={7}\n        title={text['header_title']}\n        subtitle={text['header_subtitle']}\n        description={text['header_description']}\n      />\n      <Container className=\"mt-5 mb-5 text-justify\">\n        <Row className=\"mb-5 justify-content-center\">\n          <WIPWarning />\n        </Row>\n        <p>\n          Of course, we are analyzing only one night of sleep so it is therefore tricky to draw general conclusions\n          about your sleep. It is however fascinating to see how your night was.\n        </p>\n        <p>Without further ado, this is what was your night of sleep:</p>\n        <StackedBarChartScrollyTelling epochs={data.epochs} />\n        <p>\n          We have seen that sleep can be decomposed in mainly two stages, whereas REM and NREM, and that we can observe\n          different stage proportions across age, gender and different sleep disorders. We’ve also defined other\n          measures of your sleep architecture, such as your sleep latency, efficiency and total sleep time. In order to\n          improve your sleep hygiene, many elements can be considered:\n        </p>\n        <ul>\n          <li>\n            Alimentation: having a balanced diet and avoiding sources of caffeine can have a positive impact on one’s\n            sleep. Chocolate, soft drink, tea and decaffeinated coffee are unexpected sources of caffeine.\n          </li>\n          <li>Routine: going to sleep about at the same time, in a darkened and quiet environment.</li>\n          <li>Routine: going to sleep about at the same time, in a darkened and quiet environment.</li>\n          <li>Routine: going to sleep about at the same time, in a darkened and quiet environment.</li>\n        </ul>\n        <p>\n          Although we’ve looked at many aspects of your night’s sleep, we haven’t properly looked at your sleep\n          dynamics, whereas how your sleep evolves overnight.\n        </p>\n        <h4>Hypnogram</h4>\n        <p>\n          A hypnogram allows you to visually inspect the evolution of your night, through time. The vertical axis\n          represents how hard it is to wake up, namely the sleep deepness. We see that REM is one of the lightest sleep\n          stages (along with N1), because we unknowingly wake up from that stage. Those short periods of arousal often\n          last no longer than 15 seconds, are followed by a lighter sleep stage, and cannot be remembered the next\n          morning. If they are too frequent, they can affect your sleep quality. [5] We can see that, throughout the\n          night, stages follow about the same pattern, whereas we go from NREM (either N1, N2 and N3) and then to REM,\n          and so on. We call those sleep cycles, and those typically range from four to six, each one lasting from 90 to\n          110 minutes. Another commonly looked at measurement is the time between sleep onset and the first REM epoch,\n          namely REM latency, which corresponds to 20 minutes.\n        </p>\n        <D3Component callback={createSingleHypnogram} data={data.epochs ? [data.epochs] : null} />\n        <p>\n          Sleep cycles take place in a broader process, named the circadian rhythm. It is the one that regulates our\n          wake and sleep cycles over a 24 hours period.\n        </p>\n        <p>\n          You’ve been able to visualize and inspect your night of sleep, which we’ve classified only based on your EEG\n          recordings. In a sleep lab, electrophysiology technicians generally look at your EEG, EOG and submental EMG,\n          and then manually classify each epoch of 30 seconds that compose your night. By looking at your EEG\n          recordings, we can see some patterns that can help electrophysiology technicians, and our classifier,\n          discriminate sleep stages throughout the night.\n        </p>\n        <h4 className=\"mt-5\">Spectrogram</h4>\n        <p>\n          Above, we can see the same chart from the first visualization, which represents your sleep stages through the\n          night. Below it, there are spectrograms of both your EEG channels. Spectrograms can be viewed as if we took\n          all of your nights signal, we’ve separated it in contiguous 30 seconds chunks, stacked then horizontally and\n          to which we’ve applied the fast fourier transform. We then have, for each 30 seconds epoch, the corresponding\n          amplitudes for each frequency that makes up the signal, hence the spectra. We then converted the scale to\n          logarithmic, to better see the differences in the spectrums. We then speak of signal power instead of signal\n          amplitude, because we look at the spectrums in a logarithmic scale.\n        </p>\n        <p>\n          <strong>How to read it?</strong>\n        </p>\n        <p>\n          Red therefore means that in that 30 seconds time frame, that particular frequency had a big amplitude. Green\n          means that you had that frequency with a lower amplitude. Dark blue means that you didn’t have that frequency\n          in the signal.\n        </p>\n        <p>\n          To get a better understanding at how spectrograms work, you can check out\n          <a href=\"https://musiclab.chromeexperiments.com/Spectrogram/\" target=\"_blank\" rel=\"noopener noreferrer\">\n            {' '}\n            this visualization{' '}\n          </a>\n          that decomposes sound frequency from your microphone.\n        </p>\n        <SpectrogramScrollyTelling spectrograms={data.spectrograms} epochs={data.epochs} />\n        <p className=\"mt-5\">\n          Generally, when talking about brain waves, we group certain frequencies together into bands. There are overall\n          five frequency bands, where each has a general associated behaviour, or state of mind. We will cover those\n          when looking at time frames corresponding to each sleep stage.\n        </p>\n        <p>\n          We can associate wake stages with low-amplitude activity in the 15 to 60 Hz frequency range, called the beta\n          band. By slowly falling asleep, the signal frequencies tend to decrease into the 4 to 8 Hz range, or the theta\n          band, and to have larger amplitudes. These characteristics are associated with N1. N2 stage has the same\n          characteristics, and also includes sleep spindles. They last only a few seconds and are a large oscillation in\n          the 10 to 15 hz band. Because they do not occur during all of the 30 seconds period, they cannot be seen here.\n          Stage N3, also called slow wave sleep, is characterized by slower waves between 0.5 and 4 Hz, known as the\n          delta range, with large amplitudes. REM stage has the same characteristics as Wake stage, whereas there are\n          low voltage high frequency activity.\n        </p>\n        <p>Wanna know how accurate this data is?</p>\n        <Row className=\"scrollytelling-container__buttons\">\n          <Link to=\"/performance\">\n            <Button className=\"mt-4\" color=\"default\">\n              Check out the performances\n            </Button>\n          </Link>\n          <Button\n            className=\"mt-4\"\n            color=\"secondary\"\n            href={`data:text/json;charset=utf-8,${encodedJsonEpochs}`}\n            download=\"myresults.json\"\n          >\n            Download my results\n          </Button>\n        </Row>\n      </Container>\n    </div>\n  );\n};\n\nexport default SleepAnalysisResults;\n","import React from 'react';\nimport { Container, Row, Table } from 'reactstrap';\nimport PropTypes from 'prop-types';\n\nimport Header from 'components/header';\nimport WIPWarning from 'components/wip_warning';\nimport D3Component from 'components/d3component';\n\nimport { createComparativeHypnogram } from 'd3/hypnogram/hypnogram';\n\nimport physionetWoman78yoSleepEDF from 'assets/data/physionet_woman78yo_sleepedf';\nimport predictedWoman78yoSleepEDF from 'assets/data/predicted_woman78yo_sleepedf';\nimport electrophysiologistWoman78yoSleepEDF from 'assets/data/electrophysiologist_woman78yo_sleepedf';\nimport electrophysiologistWilliamCyton from 'assets/data/electrophysiologist_william_cyton';\nimport predictedWilliamCyton from 'assets/data/predicted_william_cyton';\n\nimport text from './text.json';\n\nconst ClassificationReport = ({ rows }) => (\n  <Table size=\"sm\" responsive>\n    <thead>\n      <tr>\n        <th></th>\n        <th>Precision (%)</th>\n        <th>Recall (%)</th>\n        <th>F1-Score (%)</th>\n        <th>Support</th>\n      </tr>\n    </thead>\n    <tbody>\n      {rows.map((row, i) => {\n        return (\n          <tr key={i}>\n            <th>{row[0]}</th>\n            {row.slice(1).map((el, j) => (\n              <td key={j}>{el}</td>\n            ))}\n          </tr>\n        );\n      })}\n    </tbody>\n  </Table>\n);\n\nClassificationReport.propTypes = {\n  rows: PropTypes.array.isRequired,\n};\n\nconst Performance = () => {\n  return (\n    <div>\n      <Header\n        sizeClass={'pb-100'}\n        shapeQty={7}\n        title={text['header_title']}\n        subtitle={text['header_subtitle']}\n        description={text['header_description']}\n      />\n      <Container className=\"mt-5 text-justify\">\n        <Row className=\"mb-5 justify-content-center\">\n          <WIPWarning />\n        </Row>\n        <p>\n          Ever wonder what is the value of this application? This page aims to illustrate the relative performance of\n          our sleep scoring compared to clinical hypnogram scoring (which is usually considered the state-of-the-art\n          technique).\n        </p>\n        <p>\n          <strong>Here is the plan:</strong>\n        </p>\n        <ul>\n          <li>\n            First, we will check how our classifier’s scoring agrees with the scoring within the Physionet's Sleep-EDF\n            dataset. Of course, we will perform this agreement test on a subset of EEG data that was never trained on.\n            This subset is composed of full nights of sleep coming from five subject of a different age group.{' '}\n          </li>\n          <li>\n            Then, we will check how this classifier performs on a full night recorded on one of our members. In order to\n            be able to make comparisons, we ask for the help of a medical electrophysiologist to score our data. This\n            manual scoring will serve as reference to get an idea of the accuracy of our model on data acquired using an\n            OpenBCI under non-clinical conditions. The AASM manual was used for scoring.\n          </li>\n          <li>\n            Finally, we will present the scoring differences between the medical electrophysiologist and Sleep-EDF. To\n            do this, we will take a random night in our dataset. This will allow us to qualify somewhat the previous\n            results and maybe get an idea of the usual disagreement level between professional scorers.\n          </li>\n        </ul>\n        <h3 className=\"mt-5\">Classifier's accuracy according to Sleep-EDF</h3>\n        <D3Component\n          callback={(svg, data) => createComparativeHypnogram(svg, data, ['Classifier', 'Sleep-EDF'])}\n          data={[predictedWoman78yoSleepEDF.epochs, physionetWoman78yoSleepEDF.epochs]}\n        />\n        <ClassificationReport\n          rows={[\n            ['W', 92, 93, 92, 242],\n            ['REM', 56, 50, 52, 86],\n            ['N1', 80, 82, 70, 32],\n            ['N2', 75, 72, 23, 368],\n            ['N3', 96, 97, 96, 68],\n            ['Accuracy', '', '', 82, 796],\n          ]}\n        />\n        <h3 className=\"mt-5\">Classifier's accuracy according to the electrophysiologist</h3>\n        <D3Component\n          callback={(svg, data) => createComparativeHypnogram(svg, data, ['Classifier', 'Electrophysiologist'])}\n          data={[predictedWilliamCyton.epochs, electrophysiologistWilliamCyton.epochs]}\n        />\n        <ClassificationReport\n          rows={[\n            ['W', 85, 93, 92, 304],\n            ['REM', 52, 50, 52, 83],\n            ['N1', 76, 80, 78, 37],\n            ['N2', 75, 60, 68, 366],\n            ['N3', 92, 93, 92, 65],\n            ['Accuracy', '', '', 74, 842],\n          ]}\n        />\n        <h3 className=\"mt-5\">Electrophysiologist and Sleep-EDF's agreement</h3>\n        <D3Component\n          callback={(svg, data) => createComparativeHypnogram(svg, data, ['Electrophysiologist', 'Sleep-EDF'])}\n          data={[electrophysiologistWoman78yoSleepEDF.epochs, physionetWoman78yoSleepEDF.epochs]}\n        />\n        <ClassificationReport\n          rows={[\n            ['W', 92, 93, 92, 304],\n            ['REM', 56, 50, 52, 83],\n            ['N1', 74, 72, 73, 37],\n            ['N2', 70, 64, 67, 366],\n            ['N3', 89, 87, 87, 65],\n            ['Accuracy', '', '', 73, 842],\n          ]}\n        />\n      </Container>\n    </div>\n  );\n};\n\nexport default Performance;\n","import { SERVER_URL } from './constants';\nimport Axios from 'axios-observable';\nimport { catchError, exhaustMap, map } from 'rxjs/operators';\nimport { timer, of } from 'rxjs';\n\nconst pingServer = () =>\n  Axios.get(SERVER_URL).pipe(\n    map(() => true),\n    catchError(() => of(false)),\n  );\n\nexport const periodicPingServer = (period) => timer(0, period).pipe(exhaustMap(pingServer));\n","export const SERVER_URL = 'http://localhost:8080';\n","import { Octokit } from '@octokit/rest';\nimport { detect } from 'detect-browser';\n\nconst octokit = new Octokit();\n\nconst CURRENT_OS_NAME = detect().os;\n\nconst ASSET_DISPLAYNAME_MAP = {\n  'polydodo_server_standalone_linux-x64.tar.gz': 'Linux',\n  'polydodo_server_standalone_macos-x64.tar.gz': 'Mac OS',\n  'polydodo_server_standalone_windows-x64.exe': 'Windows',\n};\n\nconst getPublishedReleases = async () => {\n  const releases = await octokit.repos.listReleases({ owner: 'polycortex', repo: 'polydodo' });\n  const publishedReleases = releases.data.filter((release) => !release.draft);\n  return publishedReleases;\n};\n\nexport const getLatestServerReleaseAssets = async () => {\n  const latestRelease = (await getPublishedReleases())[0];\n  return latestRelease.assets\n    .filter((asset) => asset.name.startsWith('polydodo_server'))\n    .map((asset) => ({\n      name: ASSET_DISPLAYNAME_MAP[asset.name],\n      currentOs: CURRENT_OS_NAME.includes(ASSET_DISPLAYNAME_MAP[asset.name]),\n      url: asset.browser_download_url,\n    }));\n};\n","import React, { useEffect, useState } from 'react';\nimport { Container, Row, Col, Spinner } from 'reactstrap';\nimport { getLatestServerReleaseAssets } from 'requests/latest_release';\nimport { ListGroup, ListGroupItem } from 'reactstrap';\n\nconst WaitingForServer = () => {\n  const [assets, setAssets] = useState([]);\n\n  useEffect(() => {\n    getLatestServerReleaseAssets().then((assets) => setAssets(assets));\n  }, [setAssets]);\n\n  return (\n    <Container>\n      <h3 className=\"mb-4\">Waiting for local server to be running...</h3>\n\n      <h3>Download latest server release</h3>\n      <Row>\n        <Col className=\"text-center mb-4\">\n          <ListGroup>\n            {assets.map((asset) => (\n              <ListGroupItem key={asset.name} active={asset.currentOs} tag=\"a\" href={asset.url}>\n                {asset.name}\n              </ListGroupItem>\n            ))}\n          </ListGroup>\n        </Col>\n      </Row>\n\n      <Row>\n        <Col className=\"text-center mb-4\">\n          <Spinner style={{ width: '3rem', height: '3rem' }} />\n        </Col>\n      </Row>\n    </Container>\n  );\n};\n\nexport default WaitingForServer;\n","export const MAX_FILE_UPLOAD_SIZE = 1.6e9;\nexport const ACCEPTED_FILE_TYPE = 'text/plain';\nexport const ACCEPTED_FILE_EXTENSION = '.txt';\nexport const DEVICES = {\n  CYTON: 'CYTON',\n  GANGLION: 'GANGLION',\n};\nexport const MIN_AGE = 12;\nexport const MAX_AGE = 125;\n","import { SERVER_URL } from './constants';\nimport Axios from 'axios-observable';\n\nconst objectToFormData = (obj) => {\n  const formData = new FormData();\n  for (const key in obj) {\n    formData.append(key, obj[key]);\n  }\n  return formData;\n};\n\nexport const analyzeSleep = (formData) =>\n  Axios.post(`${SERVER_URL}/analyze-sleep`, objectToFormData(formData), {\n    headers: { 'Content-Type': 'multipart/form-data' },\n  });\n","import React from 'react';\nimport { useForm } from 'react-hook-form';\nimport { Button, Container, CustomInput, Form, FormGroup, Label, Input, InputGroup, Col, Row, Alert } from 'reactstrap';\nimport { DateTime } from 'luxon';\n\nimport {\n  ACCEPTED_FILE_EXTENSION,\n  ACCEPTED_FILE_TYPE,\n  DEVICES,\n  MAX_AGE,\n  MAX_FILE_UPLOAD_SIZE,\n  MIN_AGE,\n} from './constants';\n\nimport './style.css';\nimport useGlobalState from 'hooks/useGlobalState';\nimport { analyzeSleep } from 'requests/analyze_sleep';\n\nconst dateFieldSuffix = '_date';\nconst timeFieldSuffix = '_time';\n\nconst filterInDateTimeFields = (data) =>\n  Object.keys(data)\n    .filter((field) => field.endsWith(timeFieldSuffix))\n    .map((field) => field.replace(timeFieldSuffix, ''));\n\nconst filterOutDateTimeFields = (data) =>\n  Object.entries(data).filter(([name, value]) => !(name.endsWith(dateFieldSuffix) || name.endsWith(timeFieldSuffix)));\n\nconst mergeDateTimeFields = (data) =>\n  filterInDateTimeFields(data).map((fieldPrefix) => [\n    fieldPrefix,\n    Math.floor(\n      new Date(\n        Object.entries(data)\n          .filter(([fieldName, value]) => fieldName.startsWith(fieldPrefix))\n          .map(([fieldName, value]) => value)\n          .join(' '),\n      ).getTime() / 1000,\n    ),\n  ]);\n\nconst postForm = async (formData, setResponse, setPostFormError, setIsFormSubmitted) => {\n  try {\n    const response = await analyzeSleep(formData).toPromise();\n    setResponse(response);\n  } catch (error) {\n    console.error(error);\n    setPostFormError(error);\n    setIsFormSubmitted(false);\n  }\n};\n\nconst UploadForm = () => {\n  const { register, handleSubmit, getValues, errors } = useForm({ mode: 'onChange' });\n  const [, setResponse] = useGlobalState('response');\n  const [postFormError, setPostFormError] = useGlobalState('postFormError');\n  const [, setIsFormSubmitted] = useGlobalState('isFormSubmitted');\n\n  return (\n    <Container style={{ padding: '2em 0' }}>\n      <Row>\n        <Col sm=\"12\" md={{ size: 8, offset: 2 }}>\n          <Form\n            noValidate\n            onSubmit={handleSubmit(async (data) => {\n              let formData = Object.fromEntries([...filterOutDateTimeFields(data), ...mergeDateTimeFields(data)]);\n              formData = { ...formData, file: formData.file[0] };\n              setIsFormSubmitted(true);\n              await postForm(formData, setResponse, setPostFormError, setIsFormSubmitted);\n            })}\n          >\n            <h3 className=\"upload-form__file-input-title\">Let's analyze your sleep EEG recording</h3>\n            <div>\n              <CustomInput\n                innerRef={register({\n                  required: 'A valid .txt raw EEG file must be selected.',\n                  validate: (files) => {\n                    const file = files[0];\n                    if (\n                      file.type !== ACCEPTED_FILE_TYPE ||\n                      !file.name.toLowerCase().endsWith(ACCEPTED_FILE_EXTENSION)\n                    ) {\n                      return 'A valid .txt raw OpenBCI EEG file must be selected.';\n                    } else if (file.size >= MAX_FILE_UPLOAD_SIZE) {\n                      return 'File is too large. Must be less than 1.6 Gb.';\n                    }\n                  },\n                })}\n                bsSize=\"lg\"\n                accept=\".txt, text/plain\"\n                type=\"file\"\n                id=\"file\"\n                name=\"file\"\n                label={\n                  <div>\n                    <i className=\"ni ni-cloud-upload-96 upload-form__file-input\" />\n                    <span className=\"upload-form__file-input-label-text\"> Upload your OpenBCI file </span>\n                  </div>\n                }\n              />\n              <div className=\"upload-form__error-text\">{errors.file?.message}</div>\n            </div>\n\n            <h4 className=\"upload-form__journal-title\">Journal</h4>\n            <p>\n              While recording your EEG data, you also gathered some informations about your device, yourself and your\n              sleep:\n            </p>\n            <FormGroup>\n              <Label for=\"openbci-device\">OpenBCI device used</Label>\n              <Row>\n                <Col md={12}>\n                  <CustomInput\n                    innerRef={register({ required: 'A selection must be made.' })}\n                    type=\"select\"\n                    id=\"openbci-device\"\n                    name=\"device\"\n                  >\n                    <option defaultValue></option>\n                    <option value={DEVICES.CYTON}>Cyton</option>\n                    <option value={DEVICES.GANGLION}>Ganglion</option>\n                  </CustomInput>\n                  <div className=\"upload-form__error-text\">{errors.device?.message}</div>\n                </Col>\n              </Row>\n            </FormGroup>\n\n            <Row form>\n              <Col md={6}>\n                <FormGroup inline>\n                  <Label for=\"sex\">\n                    Sex<sup>1</sup>\n                  </Label>\n                  <CustomInput\n                    innerRef={register({ required: 'A selection must be made.' })}\n                    type=\"radio\"\n                    value=\"M\"\n                    id=\"male\"\n                    name=\"sex\"\n                    label=\"Male\"\n                  />\n                  <CustomInput\n                    innerRef={register({ required: 'A selection must be made.' })}\n                    type=\"radio\"\n                    value=\"F\"\n                    id=\"female\"\n                    name=\"sex\"\n                    label=\"Female\"\n                  />\n                  <div className=\"upload-form__error-text\">{errors.sex?.message}</div>\n                </FormGroup>\n              </Col>\n              <Col md={6}>\n                <FormGroup check>\n                  <Label for=\"age\">\n                    Age<sup>1, 2</sup>\n                  </Label>\n                  <Input\n                    innerRef={register({\n                      required: 'A number must be provided',\n                      min: { value: MIN_AGE, message: `Age must be at least ${MIN_AGE} y/o` },\n                      max: { value: MAX_AGE, message: `Age cannot be more than ${MAX_AGE} y/o` },\n                    })}\n                    min={MIN_AGE}\n                    max={MAX_AGE}\n                    type=\"number\"\n                    name=\"age\"\n                    id=\"age\"\n                    placeholder=\"Enter your age\"\n                  />\n                  <div className=\"upload-form__error-text\">{errors.age?.message}</div>\n                </FormGroup>\n              </Col>\n            </Row>\n\n            <div>\n              <Row form>\n                <Col md={12}>\n                  <FormGroup>\n                    <Label>I started recording at : </Label>\n                    <InputGroup>\n                      <Input\n                        innerRef={register({\n                          required: 'Date is required.',\n                          validate: () => {\n                            const streamStart = new Date(`\n                              ${getValues('stream_start_date')} ${getValues('stream_start_time')}\n                            `);\n                            const bedTime = new Date(`${getValues('bedtime_date')} ${getValues('bedtime_time')}`);\n                            if (streamStart > bedTime) {\n                              return 'Stream start must be prior to bedtime.';\n                            }\n                          },\n                        })}\n                        max={DateTime.local().toISODate()}\n                        type=\"date\"\n                        name={`stream_start${dateFieldSuffix}`}\n                        id={`stream_start${dateFieldSuffix}`}\n                      />\n                      <Input\n                        innerRef={register({ required: 'Time is required.' })}\n                        type=\"time\"\n                        name={`stream_start${timeFieldSuffix}`}\n                        id={`stream_start${timeFieldSuffix}`}\n                      />\n                    </InputGroup>\n                    <div className=\"upload-form__error-text\">\n                      {errors.stream_start_date?.message}\n                      {errors.stream_start_date && <br />}\n                      {errors.stream_start_time?.message}\n                    </div>\n                  </FormGroup>\n                </Col>\n              </Row>\n              <Row form>\n                <Col md={6}>\n                  <FormGroup>\n                    <Label>I went to bed at :</Label>\n                    <InputGroup>\n                      <Input\n                        innerRef={register({\n                          required: 'Date is required.',\n                          validate: () => {\n                            const bedtime = new Date(`${getValues('bedtime_date')} ${getValues('bedtime_time')}`);\n                            const wakeup = new Date(`${getValues('wakeup_date')} ${getValues('wakeup_time')}`);\n                            if (bedtime > wakeup) {\n                              return 'Bedtime must be prior to wake up.';\n                            }\n                          },\n                        })}\n                        max={DateTime.local().toISODate()}\n                        type=\"date\"\n                        name={`bedtime${dateFieldSuffix}`}\n                        id={`bedtime${dateFieldSuffix}`}\n                      />\n                      <Input\n                        innerRef={register({ required: 'Time is required.' })}\n                        type=\"time\"\n                        name={`bedtime${timeFieldSuffix}`}\n                        id={`bedtime${timeFieldSuffix}`}\n                      />\n                    </InputGroup>\n                    <div className=\"upload-form__error-text\">\n                      {errors.bedtime_date?.message}\n                      {errors.bedtime_date && <br />}\n                      {errors.bedtime_time?.message}\n                    </div>\n                  </FormGroup>\n                </Col>\n                <Col md={6}>\n                  <FormGroup>\n                    <Label>And woke up at :</Label>\n                    <InputGroup>\n                      <Input\n                        innerRef={register({\n                          required: 'Date is required.',\n                          validate: () => {\n                            const wakeup = new Date(`${getValues('wakeup_date')} ${getValues('wakeup_time')}`);\n                            if (wakeup > Date.now()) {\n                              return 'Wake up must be prior to now.';\n                            }\n                          },\n                        })}\n                        max={DateTime.local().toISODate()}\n                        type=\"date\"\n                        name={`wakeup${dateFieldSuffix}`}\n                        id={`wakeup${dateFieldSuffix}`}\n                      />\n                      <Input\n                        innerRef={register({ required: 'Time is required.' })}\n                        type=\"time\"\n                        name={`wakeup${timeFieldSuffix}`}\n                        id={`wakeup${timeFieldSuffix}`}\n                      />\n                    </InputGroup>\n                    <div className=\"upload-form__error-text\">\n                      {errors.wakeup_date?.message}\n                      {errors.wakeup_date && <br />}\n                      {errors.wakeup_time?.message}\n                    </div>\n                  </FormGroup>\n                </Col>\n              </Row>\n            </div>\n\n            <Row className=\"justify-content-center\">\n              <Button\n                block\n                size=\"lg\"\n                className=\"btn btn-lg mt-4 w-50\"\n                color=\"primary\"\n                type=\"submit\"\n                onClick={() => setPostFormError(null)}\n              >\n                Analyze my sleep\n              </Button>\n            </Row>\n            {postFormError && (\n              <Row className=\"justify-content-center\">\n                <Alert color=\"danger\" size=\"lg\" className=\"mt-4\">\n                  <span>\n                    <strong>An occured while processing your file...</strong>\n                    <br />\n                    Make sure you uploaded the correct file. Perhaps the information you entered in your journal does\n                    not match the file provided.\n                  </span>\n                </Alert>\n              </Row>\n            )}\n          </Form>\n        </Col>\n      </Row>\n      <hr />\n      <small className=\"text-muted\">\n        <div className=\"mt-2\">\n          <span>\n            <sup>1</sup> Your age and sex are used to improve the quality of our prediction. Age and sex are features\n            that have a significant impact on sleep.\n          </span>\n        </div>\n        <div className=\"mt-2\">\n          <sup>2</sup> Age must be between 12 and 125 y/o. This is because this classifier was trained on healthy adults\n          between 25 and 101 y/o. It is therefore a compromise between flexibility and validity.\n        </div>\n      </small>\n    </Container>\n  );\n};\n\nexport default UploadForm;\n","import React from 'react';\nimport { Col, Container, Row, Spinner } from 'reactstrap';\n\nconst AnalysisInProgress = () => (\n  <Container>\n    <h3 className=\"mb-4\">Analyzing your sleep...</h3>\n    <p>Your sleep is currently being analyzed</p>\n    <Row>\n      <Col className=\"text-center mb-4\">\n        <Spinner style={{ width: '3rem', height: '3rem' }} />\n      </Col>\n    </Row>\n  </Container>\n);\n\nexport default AnalysisInProgress;\n","import React, { useEffect, useState } from 'react';\nimport { Container } from 'reactstrap';\nimport { Redirect } from 'react-router';\n\nimport Header from 'components/header';\nimport useGlobalState from 'hooks/useGlobalState';\nimport { periodicPingServer } from 'requests/ping_server';\nimport WaitingForServer from './waiting_for_server';\nimport UploadForm from './upload_form';\nimport { PING_PERIOD } from './constants';\nimport AnalysisInProgress from './analysis_in_progress.js';\n\nimport text from './text.json';\n\nconst AnalyzeSleep = () => {\n  const [serverReady, setServerReady] = useState(false);\n  const [isFormSubmitted] = useGlobalState('isFormSubmitted');\n  const [response] = useGlobalState('response');\n\n  useEffect(() => {\n    const subscription = periodicPingServer(PING_PERIOD).subscribe(\n      (ready) => setServerReady(ready),\n      () => null,\n    );\n    return () => subscription.unsubscribe();\n  });\n\n  if (response) {\n    return (\n      <Redirect\n        to={{\n          pathname: '/sleep-analysis-results',\n        }}\n      />\n    );\n  }\n\n  return (\n    <div>\n      <Header\n        sizeClass={'pb-100'}\n        shapeQty={7}\n        title={text['header_title']}\n        subtitle={text['header_subtitle']}\n        description={text['header_description']}\n      />\n      <Container className=\"mt-5 text-justify\">\n        <span hidden={serverReady}>\n          <WaitingForServer />\n        </span>\n        <span hidden={!serverReady || isFormSubmitted}>\n          <UploadForm />\n        </span>\n        <span hidden={!serverReady || !isFormSubmitted}>\n          <AnalysisInProgress />\n        </span>\n      </Container>\n    </div>\n  );\n};\n\nexport default AnalyzeSleep;\n","export const PING_PERIOD = 1000;\n","import { useEffect } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\n\nconst ScrollToTop = ({ location, children }) => {\n  useEffect(() => window.scrollTo(0, 0), [location.pathname]);\n\n  return children;\n};\n\nScrollToTop.propTypes = {\n  location: PropTypes.object.isRequired,\n  children: PropTypes.array.isRequired,\n};\n\nexport default withRouter(ScrollToTop);\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Route, Switch, Redirect, HashRouter } from 'react-router-dom';\nimport { Container } from 'reactstrap';\n\nimport 'argon-design-system-react/src/assets/vendor/nucleo/css/nucleo.css';\nimport 'argon-design-system-react/src/assets/vendor/font-awesome/css/font-awesome.min.css';\nimport 'argon-design-system-react/src/assets/scss/argon-design-system-react.scss';\n\nimport Header from 'components/header';\nimport Footer from 'components/footer';\nimport Navbar from 'components/navbar';\nimport SleepAnalysisResults from 'views/sleep_analysis_results';\nimport Performance from 'views/performance';\nimport AnalyzeSleep from 'views/analyze_sleep';\nimport ScrollToTop from 'components/scroll_to_top';\nimport Emoji from 'components/emoji';\n\nconst underConstruction = () => {\n  const text = {\n    header_title: 'Under',\n    header_subtitle: 'construction',\n    header_description: 'Please come back later',\n    body: 'Under Construction...',\n  };\n\n  return (\n    <div>\n      <Header\n        sizeClass={'pb-100'}\n        shapeQty={7}\n        title={text['header_title']}\n        subtitle={text['header_subtitle']}\n        description={text['header_description']}\n      />\n      <Container className=\"mt-5 text-justify\">\n        <h1>\n          {text.body} <Emoji symbol=\"🏗️\" />\n        </h1>\n      </Container>\n    </div>\n  );\n};\n\nReactDOM.render(\n  <HashRouter>\n    <ScrollToTop>\n      <Navbar />\n      <Switch>\n        <Route exact path=\"/\" render={underConstruction} />\n        <Route exact path=\"/record-my-sleep\" render={underConstruction} />\n        <Route exact path=\"/analyze-my-sleep\" render={() => <AnalyzeSleep />} />\n        <Route exact path=\"/sleep-analysis-results\" render={() => <SleepAnalysisResults />} />\n        <Route exact path=\"/performance\" render={() => <Performance />} />\n        <Redirect to=\"/\" />\n      </Switch>\n      <Footer />\n    </ScrollToTop>\n  </HashRouter>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}